<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>wForms 3.0 - Switch Behavior Test Suite</title>
    <meta name="Description"
          content="wForms is an open-source, unobtrusive javascript library that adds commonly needed behaviors to traditional web forms without the need for any programming skills."/>
    <meta http-equiv="Keywords"
          content="form, web form, html form, online form, wForms, input validation, field validation, javascript library"/>

    <script type="text/javascript" src="jsunit/app/jsUnitCore.js"></script>

    <link href="../css/wforms-jsonly.css" type="text/css" rel="stylesheet"/>
    <link href="../css/wforms-layout.css" type="text/css" rel="stylesheet"/>
    <style type="text/css">
        .offstate-z {
            display: none;
        }

        .offstate-y {
            display: none;
        }
    </style>
    <script type="text/javascript" src="../lib/base2/v1.0/src/base2.js"></script>
    <script type="text/javascript" src="../lib/base2/v1.0/src/base2-dom.js"></script>
    <script type="text/javascript" src="helper/test_helper.js"></script>
    <script type="text/javascript" src="../wforms_core.js"></script>
    <script type="text/javascript" src="../wforms_repeat.js"></script>
    <script type="text/javascript" src="../wforms_switch.js"></script>

    <script type="text/javascript">

        wFORMS.behaviors['switch'].onApply = function() {
            setUpPageStatus = 'complete';
        };

        function setUpPage() {
        }

        function setUp() {

        }

        function tearDown() {
        }

        function testApplyTo() {
            var rInstance = wFORMS.getBehaviorInstance(document.getElementById('testrepeat'), 'repeat');
            //		// repeat
            rInstance.run();
            // turn switch on
            var sInstance = wFORMS.behaviors['switch'].instance;

            document.getElementById('switcha[1]').checked = true;
            sInstance.run();

            assertTrue(hasClass(document.getElementById('casea[1]').className, 'onstate'));

            document.getElementById('switchy1[1]').checked = true;
            sInstance.run();
            //		// check
            assertTrue(hasClass(document.getElementById('testy[1]').className, 'onstate'));
        }

        function testSharedTrigger() {

            var rInstance = wFORMS.getBehaviorInstance(document.getElementById('testrepeat3'), 'repeat');
            // repeat
            rInstance.run();
            // turn switch on
            document.getElementById('switchc').checked = true;
            var sInstance = wFORMS.behaviors['switch'].instance;
            sInstance.run();

            // check
            assertTrue(hasClass(document.getElementById('testrepeat3[0]').className, 'onstate'));
            assertTrue(hasClass(document.getElementById('testrepeat3[1]').className, 'onstate'));
        }

        function testSeperatedTriggers() {

            var sInstance = wFORMS.behaviors['switch'].instance;

            document.getElementById('switchd').checked = true;
            sInstance.run();
            assertTrue(hasClass(document.getElementById('cased').className, 'onstate'));

            var rInstance = wFORMS.getBehaviorInstance(document.getElementById('cased'), 'repeat');
            rInstance.run();

            document.getElementById('switche[0][0]').checked = true;
            sInstance.run();

            assertTrue(hasClass(document.getElementById('casee[0][0]').className, 'onstate'));
            assertTrue(hasClass(document.getElementById('casee[0][1]').className, 'offstate'));
       
        }

        function testRepeatedRadioSwitch() {
            var sInstance = wFORMS.getBehaviorInstance(document.getElementById('tfa_radio-D[0]'), 'repeat');

            try {
                var parent = base2.DOM.bind(document.getElementById('tfa_radio-D[0]').parentNode);
                var count = parent.querySelectorAll("div").length;		//Count number of repeated sections
                assertEquals(1, count);

                sInstance.run(null, document.getElementById('tfa_radio-D[0]'));
                sInstance.onRemoveLinkClick(null, document.getElementById('tfa_radio-D[1]-wfDL'));
                sInstance.run(null, document.getElementById('tfa_radio-D[0]'));
                //Add -remove -add cycle

                count = parent.querySelectorAll("div").length;
                assertEquals(2, count);	//Verify that two sections now exist.

            } catch(err) {
                assertEquals("Add/remove/add fails for radio buttons", true, false);
                //force failure if error thrown (as from elem.form is null)
            }

        }

        function testDestroyAndRecoverRepeatedSection(){
            var fieldSet = document.querySelector("#testform4 fieldset");
            var rInstance = wFORMS.getBehaviorInstance(fieldSet, 'repeat');
            var sInstance = wFORMS.behaviors['switch'].instance;

            rInstance.run(null, fieldSet);

            var clonedFieldSet = document.querySelectorAll("#testform4 fieldSet").item(1);
            var target = clonedFieldSet.querySelector('div');
            sInstance.destroy(clonedFieldSet);
            clonedFieldSet.querySelectorAll("input").item(0).checked = true;
            sInstance.run();

            //the switch behavior should be disabled
            assertTrue(hasClass(target.className, 'offstate'));

            //recover the switch behavior
            sInstance.applyTo(clonedFieldSet);

            clonedFieldSet.querySelectorAll("input").item(0).checked = true;
            sInstance.run();

            //the switch behavior should take effect now
            assertTrue(hasClass(target.className, 'onstate'));
        }
    </script>

</head>

<body class="wForm">
<form id="testform">
    <fieldset class="repeat" id="testrepeat">
        <input type="checkbox" class="switch-a" id="switcha"/>Switch A<br/>

        <div id="casea" class="target" rule="or[#switcha]">This is A state</div>

        <input type="radio" name="switchy" class="switch-y" id="switchy1"/>Switch Y ON<br/>
        <input type="radio" name="switchy" class="" id="switchy2"/>Switch Y OFF<br/>

        <div id="testy" class="target" rule="or[#switchy1]">Y STATE</div>
    </fieldset>
    <hr/>
    <input type="checkbox" class="switch-z" id="switchz"/>Switch Z<br/>

    <div class="offstate-z">
        <fieldset class="repeat" id="testrepeat2">
            <select id="switchb">
                <option>--</option>
                <option class="switch-b">Switch B</option>
            </select>

            <div id="caseb" class="offstate-b">This is B state</div>
        </fieldset>
    </div>
    <hr/>
    <input type="checkbox" class="switch-c" id="switchc"/>Switch C<br/>
    <fieldset class="repeat target" id="testrepeat3" rule="or[#switchc]">
        <div id="casec" class="offstate-c">This is C state</div>
    </fieldset>
    <hr/>

    <fieldset class="repeat" id="testrepeat4">
        <input type="checkbox" class="switch-d" id="switchd"/>Switch D<br/>
        <fieldset id="cased" class="offstate-d repeat target" rule="or[#switchd]">
            <input type="checkbox" class="switch-e" id="switche"/>Switch E<br/>

            <div id="casee" class="offstate-e target" rule="or[#switche]">This is E state</div>
        </fieldset>
    </fieldset>
</form>
<a href="#" onclick='testSwitchScope(); return false;'>test scope</a>

<form id="testform3">
    <fieldset class="" id="tfa_0693953105672">
        <div class="repeat oneField" id="tfa_radio-D[0]">
			<span class="choices" id="tfa_radio[0]">
				<span class="oneChoice"><input type="radio" name="tfa_radio[0][0]" id="tfa_one[0]" class="switch-a"
                                               value="tfa_one" rel=" wfHandled"/><label class="postField"
                                                                                        for="tfa_one[0][0]">one</label></span>
				<span class="oneChoice"><input type="radio" name="tfa_radio[0][0]" id="tfa_two[0]" class=""
                                               value="tfa_two" rel=" wfHandled"/><label class="postField"
                                                                                        for="tfa_two[0][0]">two</label></span>
				<span class="oneChoice"><input type="radio" name="tfa_radio[0][0]" id="tfa_three[0]" class=""
                                               value="tfa_three" rel=" wfHandled"/><label class="postField"
                                                                                          for="tfa_three[0][0]">three</label></span>
			</span>
        </div>
    </fieldset>
</form>

<hr/>

<form id="testform4">
    <fieldset class="repeat" id="tfa_0693953105673">
        <input id="group_rd1" type="radio" name="group" /><input id="group_rd2" type="radio" name="group" />
        <div class="target" rule="or[#group_rd1]">One</div>
    </fieldset>
</form>
</body>
</html>


