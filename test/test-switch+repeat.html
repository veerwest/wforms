<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>	
	<title>wForms 3.0 - Switch Behavior Test Suite</title>
	<meta name="Description" content="wForms is an open-source, unobtrusive javascript library that adds commonly needed behaviors to traditional web forms without the need for any programming skills." />
	<meta http-equiv="Keywords" content="form, web form, html form, online form, wForms, input validation, field validation, javascript library" />
	
	<script type="text/javascript" src="jsunit/app/jsUnitCore.js"></script>
	
	<link href="../css/wforms-jsonly.css" type="text/css" rel="stylesheet" />
    <link href="../css/wforms-layout.css" type="text/css" rel="stylesheet" />
    <style type="text/css">
 		.offstate-z { display:none;}
 		.offstate-y { display:none;}
	</style> 
	<!-- 
	<script type="text/javascript" src="../build/wforms.js"></script>
	-->
	<script type="text/javascript" src="../lib/src/base2.js"></script>
	<script type="text/javascript" src="../lib/src/base2-dom.js"></script>
	<script type="text/javascript" src="../wforms_core.js"></script>
	<script type="text/javascript" src="../wforms_repeat.js"></script>	
	<script type="text/javascript" src="../wforms_switch.js"></script>
	
	<script type="text/javascript">
	
	wFORMS.behaviors['switch'].instance.prototype.onApply = function() {
		setUpPageStatus = 'complete';		
	} 
	
	function setUpPage() {}
  
  	function setUp() {
  		
  	}
	
	function tearDown() {}
	
	function _testApplyTo() {
		var rInstance = wFORMS.getBehaviorInstance(document.getElementById('testrepeat'),'repeat');
		// repeat
		rInstance.run();
		// turn switch on
		document.getElementById('switcha[1]').checked = true;	
		var sInstance = wFORMS.getBehaviorInstance(document.getElementById('testform'),'switch');	
		sInstance.run(null, document.getElementById('switcha[1]'));
		// check
		assertEquals("onstate-a", document.getElementById('casea[1]').className);
				
	}
	function testSwitchCacheInvalidation() {
		var rInstance = wFORMS.getBehaviorInstance(document.getElementById('testrepeat3'),'repeat');
		// repeat
		rInstance.run();
		// turn switch on
		document.getElementById('switchc').checked = true;	
		var sInstance = wFORMS.getBehaviorInstance(document.getElementById('testform'),'switch');	
		sInstance.run(null, document.getElementById('switchc'));
		
		// check
		assertEquals("onstate-c", document.getElementById('casec[0]').className);
		assertEquals("onstate-c", document.getElementById('casec[1]').className);
		//console.log(sInstance.cache);
		
		// check cache
		var expected = { a:'',b:'',c:'',d:'',e:'',y:'',z:'' };
		for(var i in sInstance.cache) {
			assertEquals("string", typeof expected[i]);
			delete expected[i];			
		}
		var i=0;
		for(i in expected);		
		assertEquals(0, i);
		
		assertEquals('a',1, sInstance.cache['a'].targets.length);
		assertEquals('a',1, sInstance.cache['a'].triggers.length);
		assertEquals('b',1, sInstance.cache['b'].targets.length);
		assertEquals('b',1, sInstance.cache['b'].triggers.length);
		assertEquals('c',2, sInstance.cache['c'].targets.length);
		assertEquals('c',1, sInstance.cache['c'].triggers.length);
		
		rInstance.run();
		assertEquals('c',3, sInstance.cache['c'].targets.length);
		assertEquals('c',1, sInstance.cache['c'].triggers.length);
		
		rInstance.run();
		assertEquals('c',4, sInstance.cache['c'].targets.length);
		assertEquals('c',1, sInstance.cache['c'].triggers.length);
	}
	
	function testSwitchScope(){
		
		var sInstance = wFORMS.getBehaviorInstance(document.getElementById('testform'),'switch');	
		document.getElementById('switchd').checked = true;
		sInstance.run(null, document.getElementById('switchd'));
		
		var rInstance = wFORMS.getBehaviorInstance(document.getElementById('cased'),'repeat');
		rInstance.run();
		
		document.getElementById('switche[0][0]').checked = true;
		sInstance.run(null, document.getElementById('switche[0][0]'));
		
		assertEquals("onstate-e", document.getElementById('casee[0][0]').className);
		assertEquals("offstate-e", document.getElementById('casee[0][1]').className);
		
	}
	</script>
	
</head>

<body class="wForm">
	<form id="testform">
		<fieldset class="repeat" id="testrepeat">
			<input type="checkbox" class="switch-a" id="switcha" />Switch A<br/>
			<div id="casea" class="offstate-a">This is A state</div>
			
			<input type="radio" name="switchy" class="switch-y" id="switchy1" />Switch Y ON<br/>
			<input type="radio" name="switchy" class="" id="switchy2" />Switch Y OFF<br/>
			
			<div id="testy" class="offstate-y">Y STATE</div>
		</fieldset >
		<hr/>
		<input type="checkbox" class="switch-z" id="switchz" />Switch Z<br/>
	
		<div class="offstate-z">
			<fieldset  class="repeat" id="testrepeat2">
				<select id="switchb">
					<option>--</option>
					<option class="switch-b" >Switch B</option>
				</select>
				<div id="caseb" class="offstate-b">This is B state</div>
			</fieldset>
		</div>
		<hr/>
		<input type="checkbox" class="switch-c" id="switchc" />Switch C<br/>
		<fieldset  class="repeat" id="testrepeat3">
			<div id="casec" class="offstate-c">This is C state</div>
		</fieldset>
		<hr/>
		
		<fieldset  class="repeat" id="testrepeat4">
			<input type="checkbox" class="switch-d" id="switchd" />Switch D<br/>
			<fieldset id="cased" class="offstate-d repeat">
				<input type="checkbox" class="switch-e" id="switche" />Switch E<br/>
				<div id="casee" class="offstate-e">This is E state</div>
			</fieldset>
		</fieldset>
	</form>
	<a href="#" onclick='testSwitchCacheInvalidation(); return false;'>test</a>
</body>
</html>


