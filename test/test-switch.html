<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>	
	<title>wForms 3.0 - Switch Behavior Test Suite</title>
	<meta name="Description" content="wForms is an open-source, unobtrusive javascript library that adds commonly needed behaviors to traditional web forms without the need for any programming skills." />
	<meta http-equiv="Keywords" content="form, web form, html form, online form, wForms, input validation, field validation, javascript library" />
	
	<script type="text/javascript" src="jsunit/app/jsUnitCore.js"></script>
	
	<link href="../css/wforms-jsonly.css" type="text/css" rel="stylesheet" />
    <link href="../css/wforms-layout.css" type="text/css" rel="stylesheet" />
   
	<script type="text/javascript" src="../lib/base2/v1.0/src/base2.js"></script>
	<script type="text/javascript" src="../lib/base2/v1.0/src/base2-dom.js"></script>
    <script type="text/javascript" src="helper/test_helper.js"></script>
	<script type="text/javascript" src="../wforms_core.js"></script>
    <script type="text/javascript" src="../wforms_switch.js"></script>
	<script type="text/javascript">
	
	wFORMS.behaviors['switch'].instance.onApply = function() {	
		setUpPageStatus = 'complete';		
	}; 
	
	function setUpPage() {}
  
  	function setUp() {
          base2.DOM.bind(document);
    }
	
	function tearDown() {}
	
	function testApplyTo() {
        var f = document.getElementById('testform1');
        wFORMS.behaviors['switch'].applyTo(f);
        f = document.getElementById('testform2');
        wFORMS.behaviors['switch'].applyTo(f);
  
		// Test default setting
		assertTrue(hasClass(document.querySelector('#casez').className, 'onstate'));
	}
    
	function testRadioSwitch() {
		var f = document.getElementById('testform1');
		var bInstance = wFORMS.behaviors['switch'].instance;

        assertTrue(hasClass(document.querySelector('#casea').className, 'offstate'));

		document.getElementById('switcha').checked=true;
		bInstance.run();
        assertTrue(hasClass(document.querySelector('#casea').className, 'onstate'));
        assertTrue(hasClass(document.querySelector('#caseb').className, 'offstate'));
  
		document.getElementById('switchb').checked=true;
        bInstance.run();
        assertTrue(hasClass(document.querySelector('#casea').className, 'onstate'));
        assertTrue(hasClass(document.querySelector('#caseb').className, 'onstate'));
	}
    
	function testLinkSwitch() {
		var f = document.getElementById('testform1');
        var bInstance = wFORMS.behaviors['switch'].instance;

        assertTrue(hasClass(document.querySelector('#casec').className, 'offstate'));

        fireEvent(document.querySelector('#switchc'), 'click');
        assertTrue(hasClass(document.querySelector('#casec').className, 'onstate'));

        fireEvent(document.querySelector('#switchc'), 'click');
        assertTrue(hasClass(document.querySelector('#casec').className, 'offstate'));
	}
    
	function testSelectSwitch() {
		var f = document.getElementById('testform1');
        var bInstance = wFORMS.behaviors['switch'].instance;

		var s = document.getElementById('selectTest');
		s.selectedIndex=0;
        bInstance.run();
        assertTrue(hasClass(document.querySelector('#cased').className, 'onstate'));
        assertTrue(hasClass(document.querySelector('#casee').className, 'onstate'));
        assertTrue(hasClass(document.querySelector('#casef').className, 'offstate'));
        assertTrue(hasClass(document.querySelector('#caseg').className, 'offstate'));

		s.selectedIndex=1;
        bInstance.run();
        assertTrue(hasClass(document.querySelector('#cased').className, 'offstate'));
        assertTrue(hasClass(document.querySelector('#casee').className, 'offstate'));
        assertTrue(hasClass(document.querySelector('#casef').className, 'onstate'));
        assertTrue(hasClass(document.querySelector('#caseg').className, 'offstate'));
		
		s.selectedIndex=2;
        bInstance.run();
        assertTrue(hasClass(document.querySelector('#cased').className, 'offstate'));
        assertTrue(hasClass(document.querySelector('#casee').className, 'offstate'));
        assertTrue(hasClass(document.querySelector('#casef').className, 'offstate'));
        assertTrue(hasClass(document.querySelector('#caseg').className, 'onstate'));
        
		s.selectedIndex=3;
        bInstance.run();
        assertTrue(hasClass(document.querySelector('#cased').className, 'offstate'));
        assertTrue(hasClass(document.querySelector('#casee').className, 'offstate'));
        assertTrue(hasClass(document.querySelector('#casef').className, 'offstate'));
        assertTrue(hasClass(document.querySelector('#caseg').className, 'offstate'));

		s.selectedIndex=-1;
	}

	function testMultipleSwitch() {
        var bInstance = wFORMS.behaviors['switch'].instance;

        document.getElementById('swA').checked=true;
        document.getElementById('swC').checked=true;
		bInstance.run();

        assertTrue(hasClass(document.querySelector('#target1').className, 'onstate'));
        assertTrue(hasClass(document.querySelector('#target2').className, 'onstate'));
        assertTrue(hasClass(document.querySelector('#target3').className, 'offstate'));

		document.getElementById('swC').checked=true;
		bInstance.run();

        assertTrue(hasClass(document.querySelector('#target1').className, 'onstate'));
        assertTrue(hasClass(document.querySelector('#target2').className, 'onstate'));
        assertTrue(hasClass(document.querySelector('#target3').className, 'offstate'));

		document.getElementById('swB').checked=true;
        bInstance.run();

        assertTrue(hasClass(document.querySelector('#target1').className, 'offstate'));
        assertTrue(hasClass(document.querySelector('#target2').className, 'onstate'));
        assertTrue(hasClass(document.querySelector('#target3').className, 'onstate'));

        document.getElementById('swA').checked=true;
        bInstance.run();

        assertTrue(hasClass(document.querySelector('#target1').className, 'onstate'));
        assertTrue(hasClass(document.querySelector('#target2').className, 'onstate'));
        assertTrue(hasClass(document.querySelector('#target3').className, 'offstate'));

        document.getElementById('swD').checked=true;
        bInstance.run();

        assertTrue(hasClass(document.querySelector('#target1').className, 'onstate'));
        assertTrue(hasClass(document.querySelector('#target2').className, 'offstate'));
        assertTrue(hasClass(document.querySelector('#target3').className, 'onstate'));

	}

    function testAndLogic(){
        var bInstance = wFORMS.behaviors['switch'].instance;
        
        document.getElementById('swA').checked=true;
        document.getElementById('swD').checked=true;
        bInstance.run();

        assertTrue(hasClass(document.querySelector('#target4').className, 'offstate'));

        document.getElementById('swB').checked=true;
        bInstance.run();

        assertTrue(hasClass(document.querySelector('#target4').className, 'offstate'));

        document.getElementById('swC').checked=true;
        bInstance.run();

        assertTrue(hasClass(document.querySelector('#target4').className, 'onstate'));
    }

    function testDestroyBehavior(){
        var bInstance = wFORMS.behaviors['switch'].instance;

        assertTrue(document.querySelector('#target5').hasClass('offstate'));

        //turn on
        document.querySelector('#cb1').click();
        document.querySelector('#cb2').click();
        document.querySelector('#cb3').click();
        assertTrue(document.querySelector('#target5').hasClass('onstate'));
        
        //turn off
        document.querySelector('#cb1').click();
        document.querySelector('#cb2').click();
        document.querySelector('#cb3').click();
        assertTrue(document.querySelector('#target5').hasClass('offstate'));

        bInstance.destroy(document.querySelector('#target5'));
        document.querySelector('#cb1').click();
        document.querySelector('#cb2').click();
        document.querySelector('#cb3').click();
        assertTrue(document.querySelector('#target5').hasClass('offstate'));
    }
        
    </script>

</head>

<body class="wForm">
	<form id="testform1">
		<input name="fooz" type="checkbox" class="switch-z" id="switchz" checked="checked" />Z Switch <br/>
		<div id="casez" class="target" rule="or[#switchz]">This is Z state</div>
		
		
		<input name="foo" type="radio" class="switch-a" id="switcha" />A Switch <br/>
		<input name="foo" type="radio" class="switch-b" id="switchb"  />B Switch <br/>	
		<a href="#" class="switch-c swtchIsOff" id="switchc" >C Switch</a> <br/>
	
		<select id="selectTest">
			<option class="switch-d switch-e">D &amp; E</option>
			<option id="opt2" class="switch-f">F</option>
			<option id="opt3" class="switch-g">G</option>
			<option>Test 4</option>
		</select>

		<div id="casea" class="target" rule="or[#switcha|#switchb]">This is A state</div>
		<div id="caseb" class="target" rule="or[#switchb]">This is B state</div>
		<div id="casec" class="target" rule="or[#switchc]">This is C state</div>
		<div id="cased" class="target" rule="or[#selectTest :first-child]">This is D state</div>
		<div id="casee" class="target" rule="or[#selectTest :first-child]">This is E state</div>
        <!--:nth-child(?) does not work for IE? -->
		<div id="casef" class="target" rule="or[#opt2]">This is F state</div>
		<div id="caseg" class="target" rule="or[#opt3]">This is G state</div>
        
		<a href="#" onclick="invalidateCache('testform1')">Reset Cache</a>
	</form>
	<hr/>
	<form method="post" action="" id="testform2">
		
		<label>A or B?</label>
		<input type="radio" value="A" class="switch-a" id="swA" name="AB"/>
		<label for="swA">A</label>
		<input type="radio" value="B" class="switch-b" id="swB" name="AB"/>
		<label for="swB">B</label>
		
		<br/>
		
		<div class="target" id="target1" rule="or[#swA]">
			<label>C or D?</label>
			
			<span class="oneChoice">
				<input type="radio" value="C" class="switch-c" id="swC" name="CD"/>
				<label for="swC">C</label>
			</span>
			<span class="oneChoice">
				<input type="radio" value="D" class="switch-d" id="swD" name="CD"/>
				<label for="swD">D</label>
			</span>
			
		</div>
	
		<div class="target" id="target2" rule="or[#swB|#swC]">
			<fieldset id="tfa_BC" class="">
				<legend>B or C</legend>
			</fieldset>
		</div>
			
		<div class="target" id="target3" rule="or[#swB|#swD]">
			<fieldset id="tfa_BD" class="">
				<legend>B or D</legend>
			</fieldset>
		</div>

        <div class="target" id="target4" rule="and[#swB|#swC]">
			<fieldset id="tfa_BandC" class="">
				<legend>B and C</legend>
			</fieldset>
		</div>
	
		<a href="#" onclick="invalidateCache('testform2')">Reset Cache</a>
		
	</form>

    <form id="testForm3">
        <input type="checkbox" value="A" class="switch-a" id="cb1" name="AB"/>
        <input type="checkbox" value="A" class="switch-a" id="cb2" name="AB"/>
        <input type="checkbox" value="A" class="switch-a" id="cb3" name="AB"/>

        <div class="target" id="target5" rule="and[#cb1|#cb2|#cb3]">
			<fieldset class="">
				<legend>Collective AND</legend>
                Cb1 & Cb2 & Cb3
			</fieldset>
		</div>
    </form>
	
	<script type="text/javascript">
		function invalidateCache(f) {
			if(typeof f=='string') {
				f = document.getElementById(f);
			}			
			b = wFORMS.getBehaviorInstance(f, 'switch');
			b.invalidateCache();			
		}
	
	</script>
</body>
</html>


