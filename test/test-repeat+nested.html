<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>	
	<title>wForms 3.0 - Nested Repeat Behavior Test Suite</title>
	<meta name="Description" content="wForms is an open-source, unobtrusive javascript library that adds commonly needed behaviors to traditional web forms without the need for any programming skills." />
	<meta http-equiv="Keywords" content="form, web form, html form, online form, wForms, input validation, field validation, javascript library" />
	
	<script type="text/javascript" src="jsunit/app/jsUnitCore.js"></script>
	
	<link href="../css/wforms-jsonly.css" type="text/css" rel="stylesheet" />
    <link href="../css/wforms-layout.css" type="text/css" rel="stylesheet" />
	
	<script type="text/javascript" src="../lib/base2/v1.0.1/src/base2.js"></script>
	<script type="text/javascript" src="../lib/base2/v1.0.1/src/base2-dom.js"></script>
	<script type="text/javascript" src="../wforms_core.js"></script>
	<script type="text/javascript" src="../wforms_repeat.js"></script>	
	<script type="text/javascript" src="../wforms_hint.js"></script>	
	<script type="text/javascript" src="../wforms_validation.js"></script>	
   	
	<script type="text/javascript">
	
	wFORMS.behaviors.repeat.instance.prototype.onApply = function() {
		setUpPageStatus = 'complete';
	} 
	
	function setUpPage() {}
  
  	function setUp() {  }
	
	function tearDown() {}	
	
	function testNestedRepeat(){
		//Make two copies of nestedTest0 Parent div
		var bInstance = wFORMS.getBehaviorInstance(document.getElementById('nestedTest0'), 'repeat');
		
		bInstance.run();
		bInstance.run();
		
		//Verify indices
		var originalElement = document.getElementById('nestedTest0[0]');
		assertNotNull(originalElement.id);
		
		var repeatedElement1 = document.getElementById('nestedTest0[1]');
		assertNotNull(repeatedElement1.id);		
		
		var repeatedElement2 = document.getElementById('nestedTest0[2]');
		assertNotNull(repeatedElement2.id);		
		
		//Verify parent counter number
		assertEquals("2",document.getElementById('nestedTest0[0]-RC').value);
		
		//Delete middle ([1]) repeated element
		var mockClick = {type:"click",preventDefault: function(){}};
		bInstance.onRemoveLinkClick(mockClick,document.getElementById(repeatedElement1.id+'-wfDL'));

		//Verify reindex
		var originalElement = document.getElementById('nestedTest0[0]');
		assertNotNull(originalElement.id);
		
		var repeatedElement1 = document.getElementById('nestedTest0[1]');
		assertNotNull(repeatedElement1.id);				

		assertEquals("1",document.getElementById('nestedTest0[0]-RC').value);
	
	}

	function testNestedRepeat2(){
		//Make two copies of nestedTest2 parent div
		var bParentInstance = wFORMS.getBehaviorInstance(document.getElementById('nestedTest2'), 'repeat');
		bParentInstance.run();
		bParentInstance.run();
		
		//Make two copies of child field of second copy of nestedTest2 parent div
		var bChildOfSecondCopyOfParentInstance = wFORMS.getBehaviorInstance(document.getElementById('nestedTest5[2]'), 'repeat');
		bChildOfSecondCopyOfParentInstance.run();
		bChildOfSecondCopyOfParentInstance.run();
		
		//Verify parent indices
		var originalElement = document.getElementById('nestedTest2[0]');
			assertNotNull(originalElement.id);
		var repeatedElement1 = document.getElementById('nestedTest2[1]');
			assertNotNull(repeatedElement1.id);		
		var repeatedElement2 = document.getElementById('nestedTest2[2]');
			assertNotNull(repeatedElement2.id);		
			assertEquals("2",document.getElementById('nestedTest2[0]-RC').value);
		
		//Verify child indices
		var originalChildElement = document.getElementById('nestedTest5[2][0]');
			assertNotNull(originalChildElement.id);
		var repeatedChildElement1 = document.getElementById('nestedTest5[2][1]');
			assertNotNull(repeatedChildElement1.id);		
		var repeatedChildElement2 = document.getElementById('nestedTest5[2][2]');
			assertNotNull(repeatedChildElement2.id);		
			assertEquals("2",document.getElementById('nestedTest5[2][0]-RC').value);

		//Delete middle ([1]) child repeated element
		var mockClick = {type:"click",preventDefault: function(){}};
		bChildOfSecondCopyOfParentInstance.onRemoveLinkClick(mockClick,document.getElementById(repeatedChildElement1.id+'-wfDL'));

		//Verify reindex of child elements
		var originalChildElement = document.getElementById('nestedTest5[2][0]');
		assertNotNull(originalElement);
		var repeatedChildElement1 = document.getElementById('nestedTest5[2][1]');
		assertNotNull(repeatedElement1);				
		assertEquals("1",document.getElementById('nestedTest5[2][0]-RC').value);
		
		//Delete middle ([1]) parent repeated element
		var mockClick = {type:"click",preventDefault: function(){}};
		bParentInstance.onRemoveLinkClick(mockClick,document.getElementById("nestedTest2[1]"+'-wfDL'));

		//Verify removal of nested child indices after removal of parent section
		assertNull(document.getElementById('nestedTest5[2][0]-RC'));
		
		//Verify reindex of parent
		var originalElement = document.getElementById('nestedTest2[0]');
		assertNotNull(originalElement,'nestedTest2[0]');
		var repeatedElement1 = document.getElementById('nestedTest2[1]');
		assertNotNull(repeatedElement1,'nestedTest2[1]');		

		//Verify child index
		var originalElement = document.getElementById('nestedTest5[1][0]');
		assertNotNull(originalElement,'nestedTest5[1][0]');
		var repeatedElement1 = document.getElementById('nestedTest5[1][1]');
		assertNotNull(repeatedElement1,'nestedTest5[1][1]');		
		
		assertEquals("1",document.getElementById('nestedTest2[0]-RC').value);
	}

	
	</script>
	
</head>

<body class="wForm">




	<h2>Repeat Nested Behavior Test Suite</h2>


	<form method="post" action="http://app.formassembly.com/responses/testprocessor" id="testRepeatForm" style="width: 550px">
		<fieldset class="repeat" id="nestedTest0"><legend>Parent Repeat</legend>
			<div class="oneField">
				<input id="nestedTestInput0" type="text" size="40" />
			</div>
			<fieldset class="repeat" id="nestedTest1"><legend>Nested Repeat</legend>
				<div class="oneField">
					<input id="nestedTestInput1" type="text" size="40" />
				</div>
				<div class="oneField">
					<input id="nestedTestInput2" type="text" size="40" />
				</div>			
			</fieldset>
			<div class="oneField">
				<input id="nestedTestInput3" type="text"  size="40" />
			</div>
		</fieldset>
		
		<fieldset class="repeat" id="nestedTest2"><legend>Parent Repeat</legend>
			<div class="oneField">
				<input id="nestedTestInput4" type="text" size="40" />
			</div>
			<fieldset class="repeat" id="nestedTest5"><legend>Nested Repeat</legend>
				<div class="oneField">
					<input id="nestedTestInput6" type="text" size="40" />
				</div>
				<div class="oneField">
					<input id="nestedTestInput7" type="text" size="40" />
				</div>			
			</fieldset>
			<div class="oneField">
				<input id="nestedTestInput8" type="text"  size="40" />
			</div>
		</fieldset>
		
	</form>
</body>
</html>


