var base2={name:"base2",version:"1.0 (beta 2)",exports:"Base,Package,Abstract,Module,Enumerable,Map,Collection,RegGrp,"+"assert,assertArity,assertType,assignID,copy,detect,extend,"+"forEach,format,global,instanceOf,match,rescape,slice,trim,typeOf,"+"I,K,Undefined,Null,True,False,bind,delegate,flip,not,unbind",global:this,detect:new function(_){var global=_;var jscript=NaN;var java=_.java?true:false;if(_.navigator){var MSIE=/MSIE[\d.]+/g;var element=document.createElement("span");var userAgent=navigator.userAgent.replace(/([a-z])[\s\/](\d)/gi,"$1$2");if(!jscript)userAgent=userAgent.replace(MSIE,"");if(MSIE.test(userAgent))userAgent=userAgent.match(MSIE)[0]+" "+userAgent.replace(MSIE,"");userAgent=navigator.platform+" "+userAgent;java&=navigator.javaEnabled();}
return function(expression){var r=false;var not=expression.charAt(0)=="!";if(not)expression=expression.slice(1);if(expression.charAt(0)=="("){try{eval("r=!!"+expression);}catch(e){}}else{r=new RegExp("("+expression+")","i").test(userAgent);}
return!!(not^r);};}(this)};new function(_){var _namespace="function base(o,a){return o.base.apply(o,a)};";eval(_namespace);var detect=base2.detect;var Undefined=K(),Null=K(null),True=K(true),False=K(false);var _FORMAT=/%([1-9])/g;var _LTRIM=/^\s\s*/;var _RTRIM=/\s\s*$/;var _RESCAPE=/([\/()[\]{}|*+-.,^$?\\])/g;var _BASE=/eval/.test(detect)?/\bbase\s*\(/:/.*/;var _HIDDEN=["constructor","toString","valueOf"];var _MSIE_NATIVE_FUNCTION=detect("(jscript)")?new RegExp("^"+rescape(isNaN).replace(/isNaN/,"\\w+")+"$"):{test:False};var _counter=1;var _slice=Array.prototype.slice;var slice=Array.slice||function(array){return _slice.apply(array,_slice.call(arguments,1));};_Function_forEach();var _subclass=function(_instance,_static){base2.__prototyping=this.prototype;var _prototype=new this;extend(_prototype,_instance);delete base2.__prototyping;var _constructor=_prototype.constructor;function _class(){if(!base2.__prototyping){if(this.constructor==arguments.callee||this.__constructing){this.__constructing=true;_constructor.apply(this,arguments);delete this.__constructing;}else{return extend(arguments[0],_prototype);}}
return this;};_prototype.constructor=_class;for(var i in Base)_class[i]=this[i];_class.ancestor=this;_class.base=Undefined;_class.init=Undefined;extend(_class,_static);_class.prototype=_prototype;_class.init();;;;_class.toString=K(String(_constructor));;;;_class["#implements"]=[];;;;_class["#implemented_by"]=[];return _class;};var Base=_subclass.call(Object,{constructor:function(){if(arguments.length>0){this.extend(arguments[0]);}},base:function(){},extend:delegate(extend)},Base={ancestorOf:delegate(_ancestorOf),extend:_subclass,forEach:delegate(_Function_forEach),implement:function(source){if(typeof source=="function"){if(_ancestorOf(Base,source)){source(this.prototype);;;;this["#implements"].push(source);;;;source["#implemented_by"].push(this);}}else{extend(this.prototype,source);}
return this;}});var Package=Base.extend({constructor:function(_private,_public){this.extend(_public);if(this.init)this.init();if(this.name!="base2"){if(!this.parent)this.parent=base2;this.parent.addName(this.name,this);this.namespace=format("var %1=%2;",this.name,String(this).slice(1,-1));}
var LIST=/[^\s,]+/g;if(_private){_private.imports=Array2.reduce(this.imports.match(LIST),function(namespace,name){eval("var ns=base2."+name);assert(ns,format("Package not found: '%1'.",name),ReferenceError);return namespace+=ns.namespace;},_namespace+base2.namespace+JavaScript.namespace);_private.exports=Array2.reduce(this.exports.match(LIST),function(namespace,name){var fullName=this.name+"."+name;this.namespace+="var "+name+"="+fullName+";";return namespace+="if(!"+fullName+")"+fullName+"="+name+";";},"",this);}},exports:"",imports:"",name:"",namespace:"",parent:null,addName:function(name,value){if(!this[name]){this[name]=value;this.exports+=","+name;this.namespace+=format("var %1=%2.%1;",name,this.name);}},addPackage:function(name){this.addName(name,new Package(null,{name:name,parent:this}));},toString:function(){return format("[%1]",this.parent?String(this.parent).slice(1,-1)+"."+this.name:this.name);}});var Abstract=Base.extend({constructor:function(){throw new TypeError("Class cannot be instantiated.");}});var Module=Abstract.extend(null,{extend:function(_interface,_static){var module=this.base();module.implement(this);module.implement(_interface);extend(module,_static);module.init();return module;},implement:function(_interface){var module=this;if(typeof _interface=="function"){if(!_ancestorOf(_interface,module)){this.base(_interface);}
if(_ancestorOf(Module,_interface)){forEach(_interface,function(property,name){if(!module[name]){if(typeof property=="function"&&property.call&&_interface.prototype[name]){property=function(){return _interface[name].apply(_interface,arguments);};}
module[name]=property;}});}}else{extend(module,_interface);_Function_forEach(Object,_interface,function(source,name){if(name.charAt(0)=="@"){if(detect(name.slice(1))){forEach(source,arguments.callee);}}else if(typeof source=="function"&&source.call){module.prototype[name]=function(){var args=_slice.call(arguments);args.unshift(this);return module[name].apply(module,args);};;;;module.prototype[name]._module=module;}});}
return module;}});var Enumerable=Module.extend({every:function(object,test,context){var result=true;try{this.forEach(object,function(value,key){result=test.call(context,value,key,object);if(!result)throw StopIteration;});}catch(error){if(error!=StopIteration)throw error;}
return!!result;},filter:function(object,test,context){var i=0;return this.reduce(object,function(result,value,key){if(test.call(context,value,key,object)){result[i++]=value;}
return result;},[]);},invoke:function(object,method){var args=_slice.call(arguments,2);return this.map(object,(typeof method=="function")?function(item){return(item==null)?undefined:method.apply(item,args);}:function(item){return(item==null)?undefined:item[method].apply(item,args);});},map:function(object,block,context){var result=[],i=0;this.forEach(object,function(value,key){result[i++]=block.call(context,value,key,object);});return result;},pluck:function(object,key){return this.map(object,function(item){return(item==null)?undefined:item[key];});},reduce:function(object,block,result,context){var initialised=arguments.length>2;this.forEach(object,function(value,key){if(initialised){result=block.call(context,result,value,key,object);}else{result=value;initialised=true;}});return result;},some:function(object,test,context){return!this.every(object,not(test),context);}},{forEach:forEach});var _HASH="#";var Map=Base.extend({constructor:function(values){this.merge(values);},copy:delegate(copy),forEach:function(block,context){for(var key in this)if(key.charAt(0)==_HASH){block.call(context,this[key],key.slice(1),this);}},get:function(key){return this[_HASH+key];},getKeys:function(){return this.map(flip(I));},getValues:function(){return this.map(I);},has:function(key){return _HASH+key in this;},merge:function(values){var put=flip(this.put);forEach(arguments,function(values){forEach(values,put,this);},this);return this;},remove:function(key){delete this[_HASH+key];},put:function(key,value){if(arguments.length==1)value=key;this[_HASH+key]=value;},size:function(){var size=0;for(var key in this)if(key.charAt(0)==_HASH)size++;return size;},union:function(values){return this.merge.apply(this.copy(),arguments);}});Map.implement(Enumerable);var _KEYS="~";var Collection=Map.extend({constructor:function(values){this[_KEYS]=new Array2;this.base(values);},add:function(key,item){assert(!this.has(key),"Duplicate key '"+key+"'.");this.put.apply(this,arguments);},copy:function(){var copy=this.base();copy[_KEYS]=this[_KEYS].copy();return copy;},forEach:function(block,context){var keys=this[_KEYS];var length=keys.length;for(var i=0;i<length;i++){block.call(context,this[_HASH+keys[i]],keys[i],this);}},getAt:function(index){if(index<0)index+=this[_KEYS].length;var key=this[_KEYS][index];return(key===undefined)?undefined:this[_HASH+key];},getKeys:function(){return this[_KEYS].concat();},indexOf:function(key){return this[_KEYS].indexOf(String(key));},insertAt:function(index,key,item){assert(Math.abs(index)<this[_KEYS].length,"Index out of bounds.");assert(!this.has(key),"Duplicate key '"+key+"'.");this[_KEYS].insertAt(index,String(key));this[_HASH+key]==null;this.put.apply(this,_slice.call(arguments,1));},item:function(keyOrIndex){return this[typeof keyOrIndex=="number"?"getAt":"get"](keyOrIndex);},put:function(key,item){if(arguments.length==1)item=key;if(!this.has(key)){this[_KEYS].push(String(key));}
var klass=this.constructor;if(klass.Item&&!instanceOf(item,klass.Item)){item=klass.create.apply(klass,arguments);}
this[_HASH+key]=item;},putAt:function(index,item){assert(Math.abs(index)<this[_KEYS].length,"Index out of bounds.");arguments[0]=this[_KEYS].item(index);this.put.apply(this,arguments);},remove:function(key){if(this.has(key)){this[_KEYS].remove(String(key));delete this[_HASH+key];}},removeAt:function(index){var key=this[_KEYS].removeAt(index);delete this[_HASH+key];},reverse:function(){this[_KEYS].reverse();return this;},size:function(){return this[_KEYS].length;},sort:function(compare){if(compare){var self=this;this[_KEYS].sort(function(key1,key2){return compare(self[_HASH+key1],self[_HASH+key2],key1,key2);});}else this[_KEYS].sort();return this;},toString:function(){return String(this[_KEYS]);}},{Item:null,create:function(key,item){return this.Item?new this.Item(key,item):item;},extend:function(_instance,_static){var klass=this.base(_instance);klass.create=this.create;extend(klass,_static);if(!klass.Item){klass.Item=this.Item;}else if(typeof klass.Item!="function"){klass.Item=(this.Item||Base).extend(klass.Item);}
klass.init();return klass;}});var _RG_BACK_REF=/\\(\d+)/g,_RG_ESCAPE_CHARS=/\\./g,_RG_ESCAPE_BRACKETS=/\(\?[:=!]|\[[^\]]+\]/g,_RG_BRACKETS=/\(/g,_RG_LOOKUP=/\$(\d+)/,_RG_LOOKUP_SIMPLE=/^\$\d+$/;var RegGrp=Collection.extend({constructor:function(values,flags){this.base(values);if(typeof flags=="string"){this.global=/g/.test(flags);this.ignoreCase=/i/.test(flags);}},global:true,ignoreCase:false,exec:function(string,replacement){var flags=(this.global?"g":"")+(this.ignoreCase?"i":"");string=String(string)+"";if(arguments.length==1){var self=this;var keys=this[_KEYS];replacement=function(match){if(match){var item,offset=1,i=0;while((item=self[_HASH+keys[i++]])){var next=offset+item.length+1;if(arguments[offset]){var replacement=item.replacement;switch(typeof replacement){case"function":return replacement.apply(self,_slice.call(arguments,offset,next));case"number":return arguments[offset+replacement];default:return replacement;}}
offset=next;}}
return"";};}
return string.replace(new RegExp(this,flags),replacement);},insertAt:function(index,expression,replacement){if(instanceOf(expression,RegExp)){arguments[1]=expression.source;}
return base(this,arguments);},test:function(string){return this.exec(string)!=string;},toString:function(){var length=0;return"("+this.map(function(item){var ref=String(item).replace(_RG_BACK_REF,function(match,index){return"\\"+(1+Number(index)+length);});length+=item.length+1;return ref;}).join(")|(")+")";}},{IGNORE:"$0",init:function(){forEach("add,get,has,put,remove".split(","),function(name){_override(this,name,function(expression){if(instanceOf(expression,RegExp)){arguments[0]=expression.source;}
return base(this,arguments);});},this.prototype);},Item:{constructor:function(expression,replacement){if(typeof replacement=="number")replacement=String(replacement);else if(replacement==null)replacement="";if(typeof replacement=="string"&&_RG_LOOKUP.test(replacement)){if(_RG_LOOKUP_SIMPLE.test(replacement)){replacement=parseInt(replacement.slice(1));}else{var Q=/'/.test(replacement.replace(/\\./g,""))?'"':"'";replacement=replacement.replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\$(\d+)/g,Q+"+(arguments[$1]||"+Q+Q+")+"+Q);replacement=new Function("return "+Q+replacement.replace(/(['"])\1\+(.*)\+\1\1$/,"$1")+Q);}}
this.length=RegGrp.count(expression);this.replacement=replacement;this.toString=K(String(expression));},length:0,replacement:""},count:function(expression){expression=String(expression).replace(_RG_ESCAPE_CHARS,"").replace(_RG_ESCAPE_BRACKETS,"");return match(expression,_RG_BRACKETS).length;}});var JavaScript={name:"JavaScript",version:base2.version,exports:"Array2,Date2,String2",namespace:"",bind:function(host){forEach(this.exports.match(/\w+/g),function(name2){var name=name2.slice(0,-1);extend(host[name],this[name2]);this[name2](host[name].prototype);},this);return this;}};if((new Date).getYear()>1900){Date.prototype.getYear=function(){return this.getFullYear()-1900;};Date.prototype.setYear=function(year){return this.setFullYear(year+1900);};}
Function.prototype.prototype={};if("".replace(/^/,K("$$"))=="$"){extend(String.prototype,"replace",function(expression,replacement){if(typeof replacement=="function"){var fn=replacement;replacement=function(){return String(fn.apply(null,arguments)).split("$").join("$$");};}
return this.base(expression,replacement);});}
var Array2=_createObject2(Array,Array,"concat,join,pop,push,reverse,shift,slice,sort,splice,unshift",[Enumerable,{combine:function(keys,values){if(!values)values=keys;return this.reduce(keys,function(hash,key,index){hash[key]=values[index];return hash;},{});},contains:function(array,item){return this.indexOf(array,item)!=-1;},copy:function(array){var copy=_slice.call(array);if(!copy.swap)this(copy);return copy;},flatten:function(array){var length=0;return this.reduce(array,function(result,item){if(this.like(item)){this.reduce(item,arguments.callee,result,this);}else{result[length++]=item;}
return result;},[],this);},forEach:_Array_forEach,indexOf:function(array,item,fromIndex){var length=array.length;if(fromIndex==null){fromIndex=0;}else if(fromIndex<0){fromIndex=Math.max(0,length+fromIndex);}
for(var i=fromIndex;i<length;i++){if(array[i]===item)return i;}
return-1;},insertAt:function(array,index,item){this.splice(array,index,0,item);return item;},item:function(array,index){if(index<0)index+=array.length;return array[index];},lastIndexOf:function(array,item,fromIndex){var length=array.length;if(fromIndex==null){fromIndex=length-1;}else if(fromIndex<0){fromIndex=Math.max(0,length+fromIndex);}
for(var i=fromIndex;i>=0;i--){if(array[i]===item)return i;}
return-1;},map:function(array,block,context){var result=[];this.forEach(array,function(item,index){result[index]=block.call(context,item,index,array);});return result;},remove:function(array,item){var index=this.indexOf(array,item);if(index!=-1)this.removeAt(array,index);return item;},removeAt:function(array,index){return this.splice(array,index,1);},swap:function(array,index1,index2){if(index1<0)index1+=array.length;if(index2<0)index2+=array.length;var temp=array[index1];array[index1]=array[index2];array[index2]=temp;return array;}}]);Array2.reduce=Enumerable.reduce;Array2.like=function(object){return!!(object&&typeof object=="object"&&typeof object.length=="number");};;;;Enumerable["#implemented_by"].pop();;;;Enumerable["#implemented_by"].push(Array2);var _DATE_PATTERN=/^((-\d+|\d{4,})(-(\d{2})(-(\d{2}))?)?)?T((\d{2})(:(\d{2})(:(\d{2})(\.(\d{1,3})(\d)?\d*)?)?)?)?(([+-])(\d{2})(:(\d{2}))?|Z)?$/;var _DATE_PARTS={FullYear:2,Month:4,Date:6,Hours:8,Minutes:10,Seconds:12,Milliseconds:14};var _TIMEZONE_PARTS={Hectomicroseconds:15,UTC:16,Sign:17,Hours:18,Minutes:20};var _TRIM_ZEROES=/(((00)?:0+)?:0+)?\.0+$/;var _TRIM_TIMEZONE=/(T[0-9:.]+)$/;var Date2=_createObject2(Date,function(yy,mm,dd,h,m,s,ms){switch(arguments.length){case 0:return new Date;case 1:return new Date(yy);default:return new Date(yy,mm,arguments.length==2?1:dd,h||0,m||0,s||0,ms||0);}},"",[{toISOString:function(date){var string="####-##-##T##:##:##.###";for(var part in _DATE_PARTS){string=string.replace(/#+/,function(digits){var value=date["getUTC"+part]();if(part=="Month")value++;return("000"+value).slice(-digits.length);});}
return string.replace(_TRIM_ZEROES,"").replace(_TRIM_TIMEZONE,"$1Z");}}]);Date2.now=function(){return(new Date).valueOf();};Date2.parse=function(string,defaultDate){if(arguments.length>1){assertType(defaultDate,"number","defaultDate should be of type 'number'.")}
var match=String(string).match(_DATE_PATTERN);if(match){if(match[_DATE_PARTS.Month])match[_DATE_PARTS.Month]--;if(match[_TIMEZONE_PARTS.Hectomicroseconds]>=5)match[_DATE_PARTS.Milliseconds]++;var date=new Date(defaultDate||0);var prefix=match[_TIMEZONE_PARTS.UTC]||match[_TIMEZONE_PARTS.Hours]?"UTC":"";for(var part in _DATE_PARTS){var value=match[_DATE_PARTS[part]];if(!value)continue;date["set"+prefix+part](value);if(date["get"+prefix+part]()!=match[_DATE_PARTS[part]]){return NaN;}}
if(match[_TIMEZONE_PARTS.Hours]){var Hours=Number(match[_TIMEZONE_PARTS.Sign]+match[_TIMEZONE_PARTS.Hours]);var Minutes=Number(match[_TIMEZONE_PARTS.Sign]+(match[_TIMEZONE_PARTS.Minutes]||0));date.setUTCMinutes(date.getUTCMinutes()+(Hours*60)+Minutes);}
return date.valueOf();}else{return Date.parse(string);}};var String2=_createObject2(String,function(string){return new String(arguments.length==0?"":string);},"charAt,charCodeAt,concat,indexOf,lastIndexOf,match,replace,search,slice,split,substr,substring,toLowerCase,toUpperCase",[{trim:trim}]);function _createObject2(Native,constructor,generics,extensions){var INative=Module.extend();forEach(generics.match(/\w+/g),function(name){INative[name]=unbind(Native.prototype[name]);});forEach(extensions,INative.implement,INative);var Native2=function(){return INative(this.constructor==INative?constructor.apply(null,arguments):arguments[0]);};Native2.prototype=INative.prototype;forEach(INative,function(method,name){if(Native[name]){INative[name]=Native[name];delete INative.prototype[name];}
Native2[name]=INative[name];});Native2.ancestor=Object;delete Native2.extend;if(Native!=Array)delete Native2.forEach;return Native2;};function extend(object,source){if(object&&source){if(arguments.length>2){var key=source;source={};source[key]=arguments[2];}
var proto=(typeof source=="function"?Function:Object).prototype;var i=_HIDDEN.length,key;if(base2.__prototyping){while(key=_HIDDEN[--i]){var value=source[key];if(value!=proto[key]){if(_BASE.test(value)){_override(object,key,value)}else{object[key]=value;}}}}
for(key in source){if(proto[key]===undefined){var value=source[key];if(key.charAt(0)=="@"){if(detect(key.slice(1)))arguments.callee(object,value);continue;}
var ancestor=object[key];if(ancestor&&typeof value=="function"){if(value!=ancestor&&(!ancestor.method||!_ancestorOf(value,ancestor))){if(_BASE.test(value)){_override(object,key,value);}else{value.ancestor=ancestor;object[key]=value;}}}else{object[key]=value;}}}}
return object;};function _ancestorOf(ancestor,fn){while(fn){if(!fn.ancestor)return false;fn=fn.ancestor;if(fn==ancestor)return true;}
return false;};function _override(object,name,method){var ancestor=object[name];var superObject=base2.__prototyping;if(superObject&&ancestor!=superObject[name])superObject=null;function _base(){var previous=this.base;this.base=superObject?superObject[name]:ancestor;var returnValue=method.apply(this,arguments);this.base=previous;return returnValue;};_base.ancestor=ancestor;object[name]=_base;;;;_base.toString=K(String(method));};if(typeof StopIteration=="undefined"){StopIteration=new Error("StopIteration");}
function forEach(object,block,context,fn){if(object==null)return;if(!fn){if(typeof object=="function"&&object.call){fn=Function;}else if(typeof object.forEach=="function"&&object.forEach!=arguments.callee){object.forEach(block,context);return;}else if(typeof object.length=="number"){_Array_forEach(object,block,context);return;}}
_Function_forEach(fn||Object,object,block,context);};function _Array_forEach(array,block,context){if(array==null)return;var length=array.length,i;if(typeof array=="string"){for(i=0;i<length;i++){block.call(context,array.charAt(i),i,array);}}else{for(i=0;i<length;i++){if(i in array)
block.call(context,array[i],i,array);}}};function _Function_forEach(fn,object,block,context){var Temp=function(){this.i=1};Temp.prototype={i:1};var count=0;for(var i in new Temp)count++;_Function_forEach=(count>1)?function(fn,object,block,context){var processed={};for(var key in object){if(!processed[key]&&fn.prototype[key]===undefined){processed[key]=true;block.call(context,object[key],key,object);}}}:function(fn,object,block,context){for(var key in object){if(fn.prototype[key]===undefined){block.call(context,object[key],key,object);}}};_Function_forEach(fn,object,block,context);};function typeOf(object){var type=typeof object;switch(type){case"object":return object===null?"null":typeof object.call=="function"||_MSIE_NATIVE_FUNCTION.test(object)?"function":type;case"function":return typeof object.call=="function"?type:"object";default:return type;}};function instanceOf(object,klass){if(typeof klass!="function"){throw new TypeError("Invalid 'instanceOf' operand.");}
if(object==null)return false;if(object instanceof klass)return true;if(Base.ancestorOf==klass.ancestorOf)return false;if(Base.ancestorOf==object.constructor.ancestorOf)return klass==Object;switch(klass){case Array:return!!(typeof object=="object"&&object.join&&object.splice);case Function:return typeOf(object)=="function";case RegExp:return typeof object.constructor.$1=="string";case Date:return!!object.getTimezoneOffset;case String:case Number:case Boolean:return typeof object==typeof klass.prototype.valueOf();case Object:return true;}
return false;};function assert(condition,message,ErrorClass){if(!condition){throw new(ErrorClass||Error)(message||"Assertion failed.");}};function assertArity(args,arity,message){if(arity==null)arity=args.callee.length;if(args.length<arity){throw new SyntaxError(message||"Not enough arguments.");}};function assertType(object,type,message){if(type&&(typeof type=="function"?!instanceOf(object,type):typeOf(object)!=type)){throw new TypeError(message||"Invalid type.");}};function assignID(object){if(!object.base2ID)object.base2ID="b2_"+_counter++;return object.base2ID;};function copy(object){var fn=function(){};fn.prototype=object;return new fn;};function format(string){var args=arguments;var pattern=new RegExp("%([1-"+arguments.length+"])","g");return String(string).replace(pattern,function(match,index){return args[index];});};function match(string,expression){return String(string).match(expression)||[];};function rescape(string){return String(string).replace(_RESCAPE,"\\$1");};function trim(string){return String(string).replace(_LTRIM,"").replace(_RTRIM,"");};function I(i){return i;};function K(k){return function(){return k;};};function bind(fn,context){var args=_slice.call(arguments,2);return args.length==0?function(){return fn.apply(context,arguments);}:function(){return fn.apply(context,args.concat.apply(args,arguments));};};function delegate(fn,context){return function(){var args=_slice.call(arguments);args.unshift(this);return fn.apply(context,args);};};function flip(fn){return function(){return fn.apply(this,Array2.swap(arguments,0,1));};};function not(fn){return function(){return!fn.apply(this,arguments);};};function unbind(fn){return function(context){return fn.apply(context,_slice.call(arguments,1));};};base2=new Package(this,base2);eval(this.exports);base2.extend=extend;forEach(Enumerable,function(method,name){if(!Module[name])base2.addName(name,bind(method,Enumerable));});JavaScript=new Package(this,JavaScript);eval(this.exports);};new function(_){var DOM=new base2.Package(this,{name:"DOM",version:"1.0 (beta 2)",exports:"Interface,Binding,Node,Document,Element,AbstractView,HTMLDocument,HTMLElement,"+"Selector,Traversal,XPathParser,NodeSelector,DocumentSelector,ElementSelector,"+"StaticNodeList,Event,EventTarget,DocumentEvent,ViewCSS,CSSStyleDeclaration",bind:function(node){if(node&&node.nodeType){var uid=assignID(node);if(!DOM.bind[uid]){switch(node.nodeType){case 1:if(typeof node.className=="string"){(HTMLElement.bindings[node.tagName]||HTMLElement).bind(node);}else{Element.bind(node);}
break;case 9:if(node.writeln){HTMLDocument.bind(node);}else{Document.bind(node);}
break;default:Node.bind(node);}
DOM.bind[uid]=true;}}
return node;},"@MSIE5.+win":{bind:function(node){if(node&&node.writeln){node.nodeType=9;}
return this.base(node);}}});eval(this.imports);var _MSIE=detect("MSIE");var _MSIE5=detect("MSIE5");var Interface=Module.extend(null,{implement:function(_interface){var module=this;if(Interface.ancestorOf(_interface)){forEach(_interface,function(property,name){if(_interface[name]._delegate){module[name]=function(){return _interface[name].apply(_interface,arguments);};}});}else if(typeof _interface=="object"){this.forEach(_interface,function(source,name){if(name.charAt(0)=="@"){forEach(source,arguments.callee);}else if(typeof source=="function"&&source.call){if(!module[name]){var FN="var fn=function _%1(%2){%3.base=%3.%1.ancestor;var m=%3.base?'base':'%1';return %3[m](%4)}";var args="abcdefghij".split("").slice(-source.length);eval(format(FN,name,args,args[0],args.slice(1)));fn._delegate=name;module[name]=fn;}}});}
return this.base(_interface);}});var Binding=Interface.extend(null,{bind:function(object){return extend(object,this.prototype);}});var Node=Binding.extend({"@!(element.compareDocumentPosition)":{compareDocumentPosition:function(node,other){if(Traversal.contains(node,other)){return 4|16;}else if(Traversal.contains(other,node)){return 2|8;}
var nodeIndex=_getSourceIndex(node);var otherIndex=_getSourceIndex(other);if(nodeIndex<otherIndex){return 4;}else if(nodeIndex>otherIndex){return 2;}
return 0;}}});var _getSourceIndex=document.documentElement.sourceIndex?function(node){return node.sourceIndex;}:function(node){var key=0;while(node){key=Traversal.getNodeIndex(node)+"."+key;node=node.parentNode;}
return key;};var Document=Node.extend(null,{bind:function(document){extend(document,"createElement",function(tagName){return DOM.bind(this.base(tagName));});AbstractView.bind(document.defaultView);if(document!=window.document)
new DOMContentLoadedEvent(document);return this.base(document);},"@!(document.defaultView)":{bind:function(document){document.defaultView=Traversal.getDefaultView(document);return this.base(document);}}});var _EVALUATED=/^(href|src)$/;var _ATTRIBUTES={"class":"className","for":"htmlFor"};var Element=Node.extend({"@MSIE.+win":{getAttribute:function(element,name,iFlags){if(element.className===undefined){return this.base(element,name);}
var attribute=_MSIE_getAttributeNode(element,name);if(attribute&&(attribute.specified||name=="value")){if(_EVALUATED.test(name)){return this.base(element,name,2);}else if(name=="style"){return element.style.cssText;}else{return attribute.nodeValue;}}
return null;},setAttribute:function(element,name,value){if(element.className===undefined){this.base(element,name,value);}else if(name=="style"){element.style.cssText=value;}else{value=String(value);var attribute=_MSIE_getAttributeNode(element,name);if(attribute){attribute.nodeValue=value;}else{this.base(element,_ATTRIBUTES[name]||name,value);}}}},"@!(element.hasAttribute)":{hasAttribute:function(element,name){return this.getAttribute(element,name)!=null;}}});extend(Element.prototype,"cloneNode",function(deep){var clone=this.base(deep||false);clone.base2ID=undefined;return clone;});if(_MSIE){var _PROPERCASE_ATTRIBUTES="colSpan,rowSpan,vAlign,dateTime,accessKey,tabIndex,encType,maxLength,readOnly,longDesc";extend(_ATTRIBUTES,Array2.combine(_PROPERCASE_ATTRIBUTES.toLowerCase().split(","),_PROPERCASE_ATTRIBUTES.split(",")));var _MSIE_getAttributeNode=_MSIE5?function(element,name){return element.attributes[name]||element.attributes[_ATTRIBUTES[name.toLowerCase()]];}:function(element,name){return element.getAttributeNode(name);};}
var TEXT=_MSIE?"innerText":"textContent";var Traversal=Module.extend({getDefaultView:function(node){return this.getDocument(node).defaultView;},getNextElementSibling:function(node){while(node&&(node=node.nextSibling)&&!this.isElement(node))continue;return node;},getNodeIndex:function(node){var index=0;while(node&&(node=node.previousSibling))index++;return index;},getOwnerDocument:function(node){return node.ownerDocument;},getPreviousElementSibling:function(node){while(node&&(node=node.previousSibling)&&!this.isElement(node))continue;return node;},getTextContent:function(node){return node[TEXT];},isEmpty:function(node){node=node.firstChild;while(node){if(node.nodeType==3||this.isElement(node))return false;node=node.nextSibling;}
return true;},setTextContent:function(node,text){return node[TEXT]=text;},"@MSIE":{getDefaultView:function(node){return(node.document||node).parentWindow;},"@MSIE5":{getOwnerDocument:function(node){return node.ownerDocument||node.document;}}}},{contains:function(node,target){while(target&&(target=target.parentNode)&&node!=target)continue;return!!target;},getDocument:function(node){return this.isDocument(node)?node:this.getOwnerDocument(node);},isDocument:function(node){return!!(node&&node.documentElement);},isElement:function(node){return!!(node&&node.nodeType==1);},"@(element.contains)":{contains:function(node,target){return node!=target&&(this.isDocument(node)?node==this.getOwnerDocument(target):node.contains(target));}},"@MSIE5":{isElement:function(node){return!!(node&&node.nodeType==1&&node.nodeName!="!");}}});var AbstractView=Binding.extend();var Event=Binding.extend({"@!(document.createEvent)":{initEvent:function(event,type,bubbles,cancelable){event.type=type;event.bubbles=bubbles;event.cancelable=cancelable;event.timeStamp=new Date().valueOf();},"@MSIE":{initEvent:function(event,type,bubbles,cancelable){this.base(event,type,bubbles,cancelable);event.cancelBubble=!event.bubbles;},preventDefault:function(event){if(event.cancelable!==false){event.returnValue=false;}},stopPropagation:function(event){event.cancelBubble=true;}}}},{"@!(document.createEvent)":{"@MSIE":{bind:function(event){if(!event.timeStamp){event.bubbles=!!_BUBBLES[event.type];event.cancelable=!!_CANCELABLE[event.type];event.timeStamp=new Date().valueOf();}
if(!event.target){event.target=event.srcElement;}
event.relatedTarget=event[(event.type=="mouseout"?"to":"from")+"Element"];return this.base(event);}}}});if(_MSIE){var _BUBBLES="abort,error,select,change,resize,scroll";var _CANCELABLE="click,mousedown,mouseup,mouseover,mousemove,mouseout,keydown,keyup,submit,reset";_BUBBLES=Array2.combine((_BUBBLES+","+_CANCELABLE).split(","));_CANCELABLE=Array2.combine(_CANCELABLE.split(","));}
var EventTarget=Interface.extend({"@!(element.addEventListener)":{addEventListener:function(target,type,listener,capture){var targetID=assignID(target);var listenerID=assignID(listener);var events=_eventMap[targetID];if(!events)events=_eventMap[targetID]={};var listeners=events[type];var current=target["on"+type];if(!listeners){listeners=events[type]={};if(current)listeners[0]=current;}
listeners[listenerID]=listener;if(current!==undefined){target["on"+type]=_eventMap._handleEvent;}},dispatchEvent:function(target,event){return _handleEvent.call(target,event);},removeEventListener:function(target,type,listener,capture){var events=_eventMap[target.base2ID];if(events&&events[type]){delete events[type][listener.base2ID];}},"@(element.fireEvent)":{dispatchEvent:function(target,event){var type="on"+event.type;event.target=target;if(target[type]===undefined){return this.base(target,event);}else{return target.fireEvent(type,event);}}}}});var _eventMap=new Base({_handleEvent:_handleEvent,"@MSIE":{_handleEvent:function(){var target=this;var window=(target.document||target).parentWindow;if(target.Infinity)target=window;return _handleEvent.call(target,window.event);}}});function _handleEvent(event){var returnValue=true;var events=_eventMap[this.base2ID];if(events){Event.bind(event);var listeners=events[event.type];for(var i in listeners){var listener=listeners[i];if(listener.handleEvent){var result=listener.handleEvent(event);}else{result=listener.call(this,event);}
if(result===false||event.returnValue===false)returnValue=false;}}
return returnValue;};var DocumentEvent=Interface.extend({"@!(document.createEvent)":{createEvent:function(document,type){return Event.bind({});},"@(document.createEventObject)":{createEvent:function(document,type){return Event.bind(document.createEventObject());}}},"@(document.createEvent)":{"@!(document.createEvent('Events'))":{createEvent:function(document,type){return this.base(document,type=="Events"?"UIEvents":type);}}}});var DOMContentLoadedEvent=Base.extend({constructor:function(document){var fired=false;this.fire=function(){if(!fired){fired=true;setTimeout(function(){var event=DocumentEvent.createEvent(document,"Events");Event.initEvent(event,"DOMContentLoaded",false,false);EventTarget.dispatchEvent(document,event);},1);}};EventTarget.addEventListener(document,"DOMContentLoaded",function(){fired=true;},false);this.listen(document);},listen:function(document){EventTarget.addEventListener(Traversal.getDefaultView(document),"load",this.fire,false);},"@MSIE.+win":{listen:function(document){if(document.readyState!="complete"){var event=this;document.write("<script id=__ready defer src=//:><\/script>");document.all.__ready.onreadystatechange=function(){if(this.readyState=="complete"){this.removeNode();event.fire();}};}}},"@KHTML":{listen:function(document){if(document.readyState!="complete"){var event=this;var timer=setInterval(function(){if(/loaded|complete/.test(document.readyState)){clearInterval(timer);event.fire();}},100);}}}});new DOMContentLoadedEvent(document);Document.implement(DocumentEvent);Document.implement(EventTarget);Element.implement(EventTarget);var _PIXEL=/^\d+(px)?$/i;var _METRICS=/(width|height|top|bottom|left|right|fontSize)$/;var _COLOR=/^(color|backgroundColor)$/;var ViewCSS=Interface.extend({"@!(document.defaultView.getComputedStyle)":{"@MSIE":{getComputedStyle:function(view,element,pseudoElement){var currentStyle=element.currentStyle;var computedStyle={};for(var i in currentStyle){if(_METRICS.test(i)){computedStyle[i]=_MSIE_getPixelValue(element,computedStyle[i])+"px";}else if(_COLOR.test(i)){computedStyle[i]=_MSIE_getColorValue(element,i=="color"?"ForeColor":"BackColor");}else{try{computedStyle[i]=currentStyle[i];}catch(x){}}}
return computedStyle;}}},getComputedStyle:function(view,element,pseudoElement){return _CSSStyleDeclaration_ReadOnly.bind(this.base(view,element,pseudoElement));}},{toCamelCase:function(string){return string.replace(/\-([a-z])/g,function(match,chr){return chr.toUpperCase();});}});function _MSIE_getPixelValue(element,value){if(_PIXEL.test(value))return parseInt(value);var styleLeft=element.style.left;var runtimeStyleLeft=element.runtimeStyle.left;element.runtimeStyle.left=element.currentStyle.left;element.style.left=value||0;value=element.style.pixelLeft;element.style.left=styleLeft;element.runtimeStyle.left=runtimeStyleLeft;return value;};function _MSIE_getColorValue(element,value){var range=element.document.body.createTextRange();range.moveToElementText(element);var color=range.queryCommandValue(value);return format("rgb(%1,%2,%3)",color&0xff,(color&0xff00)>>8,(color&0xff0000)>>16);};var _CSSStyleDeclaration_ReadOnly=Binding.extend({getPropertyValue:function(style,propertyName){return this.base(style,_CSSPropertyNameMap[propertyName]||propertyName);},"@MSIE.+win":{getPropertyValue:function(style,propertyName){return propertyName=="float"?style.styleFloat:style[ViewCSS.toCamelCase(propertyName)];}}});var CSSStyleDeclaration=_CSSStyleDeclaration_ReadOnly.extend({setProperty:function(style,propertyName,value,important){return this.base(style,_CSSPropertyNameMap[propertyName]||propertyName,value,important);},"@MSIE.+win":{setProperty:function(style,propertyName,value,priority){if(propertyName=="opacity"){value*=100;style.opacity=value;style.zoom=1;style.filter="Alpha(opacity="+value+")";}else{style.setAttribute(propertyName,value);}}}},{"@MSIE":{bind:function(style){style.getPropertyValue=this.prototype.getPropertyValue;style.setProperty=this.prototype.setProperty;return style;}}});var _CSSPropertyNameMap=new Base({"@Gecko":{opacity:"-moz-opacity"},"@KHTML":{opacity:"-khtml-opacity"}});with(CSSStyleDeclaration.prototype)getPropertyValue.toString=setProperty.toString=function(){return"[base2]";};AbstractView.implement(ViewCSS);var NodeSelector=Interface.extend({"@!(element.querySelector)":{querySelector:function(node,selector){return new Selector(selector).exec(node,1);},querySelectorAll:function(node,selector){return new Selector(selector).exec(node);}}});extend(NodeSelector.prototype,{querySelector:function(selector){return DOM.bind(this.base(selector));},querySelectorAll:function(selector){return extend(this.base(selector),"item",function(index){return DOM.bind(this.base(index));});}});var DocumentSelector=NodeSelector.extend();var ElementSelector=NodeSelector.extend({"@!(element.matchesSelector)":{matchesSelector:function(element,selector){return new Selector(selector).test(element);}}});var StaticNodeList=Base.extend({constructor:function(nodes){nodes=nodes||[];this.length=nodes.length;this.item=function(index){return nodes[index];};},length:0,forEach:function(block,context){for(var i=0;i<this.length;i++){block.call(context,this.item(i),i,this);}},item:Undefined,"@(XPathResult)":{constructor:function(nodes){if(nodes&&nodes.snapshotItem){this.length=nodes.snapshotLength;this.item=function(index){return nodes.snapshotItem(index);};}else this.base(nodes);}}});StaticNodeList.implement(Enumerable);var _CSS_ESCAPE=/'(\\.|[^'\\])*'|"(\\.|[^"\\])*"/g,_CSS_IMPLIED_ASTERISK=/([\s>+~,]|[^(]\+|^)([#.:\[])/g,_CSS_IMPLIED_SPACE=/(^|,)([^\s>+~])/g,_CSS_WHITESPACE=/\s*([\s>+~(),]|^|$)\s*/g,_CSS_WILD_CARD=/\s\*\s/g,_CSS_UNESCAPE=/\x01(\d+)/g,_QUOTE=/'/g;var CSSParser=RegGrp.extend({constructor:function(items){this.base(items);this.cache={};this.sorter=new RegGrp;this.sorter.add(/:not\([^)]*\)/,RegGrp.IGNORE);this.sorter.add(/([ >](\*|[\w-]+))([^: >+~]*)(:\w+-child(\([^)]+\))?)([^: >+~]*)/,"$1$3$6$4");},cache:null,ignoreCase:true,escape:function(selector){var strings=this._strings=[];return this.optimise(this.format(String(selector).replace(_CSS_ESCAPE,function(string){return"\x01"+strings.push(string.slice(1,-1).replace(_QUOTE,"\\'"));})));},format:function(selector){return selector.replace(_CSS_WHITESPACE,"$1").replace(_CSS_IMPLIED_SPACE,"$1 $2").replace(_CSS_IMPLIED_ASTERISK,"$1*$2");},optimise:function(selector){return this.sorter.exec(selector.replace(_CSS_WILD_CARD,">* "));},parse:function(selector){return this.cache[selector]||(this.cache[selector]=this.unescape(this.exec(this.escape(selector))));},unescape:function(selector){var strings=this._strings;return selector.replace(_CSS_UNESCAPE,function(match,index){return strings[index-1];});}});function _nthChild(match,args,position,last,not,and,mod,equals){last=/last/i.test(match)?last+"+1-":"";if(!isNaN(args))args="0n+"+args;else if(args=="even")args="2n";else if(args=="odd")args="2n+1";args=args.split("n");var a=args[0]?(args[0]=="-")?-1:parseInt(args[0]):1;var b=parseInt(args[1])||0;var negate=a<0;if(negate){a=-a;if(a==1)b++;}
var query=format(a==0?"%3%7"+(last+b):"(%4%3-%2)%6%1%70%5%4%3>=%2",a,b,position,last,and,mod,equals);if(negate)query=not+"("+query+")";return query;};var XPathParser=CSSParser.extend({constructor:function(){this.base(XPathParser.rules);this.sorter.putAt(1,"$1$4$3$6");},escape:function(selector){return this.base(selector).replace(/,/g,"\x02");},unescape:function(selector){return this.base(selector.replace(/\[self::\*\]/g,"").replace(/(^|\x02)\//g,"$1./").replace(/\x02/g," | ")).replace(/'[^'\\]*\\'(\\.|[^'\\])*'/g,function(match){return"concat("+match.split("\\'").join("',\"'\",'")+")";});},"@opera":{unescape:function(selector){return this.base(selector.replace(/last\(\)/g,"count(preceding-sibling::*)+count(following-sibling::*)+1"));}}},{init:function(){this.values.attributes[""]="[@$1]";forEach(this.types,function(add,type){forEach(this.values[type],add,this.rules);},this);},optimised:{pseudoClasses:{"first-child":"[1]","last-child":"[last()]","only-child":"[last()=1]"}},rules:extend({},{"@!KHTML":{"(^|\\x02) (\\*|[\\w-]+)#([\\w-]+)":"$1id('$3')[self::$2]","([ >])(\\*|[\\w-]+):([\\w-]+-child(\\(([^)]+)\\))?)":function(match,token,tagName,pseudoClass,$4,args){var replacement=(token==" ")?"//*":"/*";if(/^nth/i.test(pseudoClass)){replacement+=_xpath_nthChild(pseudoClass,args,"position()");}else{replacement+=XPathParser.optimised.pseudoClasses[pseudoClass];}
return replacement+"[self::"+tagName+"]";}}}),types:{identifiers:function(replacement,token){this[rescape(token)+"([\\w-]+)"]=replacement;},combinators:function(replacement,combinator){this[rescape(combinator)+"(\\*|[\\w-]+)"]=replacement;},attributes:function(replacement,operator){this["\\[([\\w-]+)\\s*"+rescape(operator)+"\\s*([^\\]]*)\\]"]=replacement;},pseudoClasses:function(replacement,pseudoClass){this[":"+pseudoClass.replace(/\(\)$/,"\\(([^)]+)\\)")]=replacement;}},values:{identifiers:{"#":"[@id='$1'][1]",".":"[contains(concat(' ',@class,' '),' $1 ')]"},combinators:{" ":"/descendant::$1",">":"/child::$1","+":"/following-sibling::*[1][self::$1]","~":"/following-sibling::$1"},attributes:{"*=":"[contains(@$1,'$2')]","^=":"[starts-with(@$1,'$2')]","$=":"[substring(@$1,string-length(@$1)-string-length('$2')+1)='$2']","~=":"[contains(concat(' ',@$1,' '),' $2 ')]","|=":"[contains(concat('-',@$1,'-'),'-$2-')]","!=":"[not(@$1='$2')]","=":"[@$1='$2']"},pseudoClasses:{"empty":"[not(child::*) and not(text())]","first-child":"[not(preceding-sibling::*)]","last-child":"[not(following-sibling::*)]","not()":_xpath_not,"nth-child()":_xpath_nthChild,"nth-last-child()":_xpath_nthChild,"only-child":"[not(preceding-sibling::*) and not(following-sibling::*)]","root":"[not(parent::*)]"}},"@opera":{init:function(){this.optimised.pseudoClasses["last-child"]=this.values.pseudoClasses["last-child"];this.optimised.pseudoClasses["only-child"]=this.values.pseudoClasses["only-child"];this.base();}}});var _notParser=new XPathParser;function _xpath_not(match,args){return"[not("+_notParser.exec(trim(args)).replace(/\[1\]/g,"").replace(/^(\*|[\w-]+)/,"[self::$1]").replace(/\]\[/g," and ").slice(1,-1)
+")]";};function _xpath_nthChild(match,args,position){return"["+_nthChild(match,args,position||"count(preceding-sibling::*)+1","last()","not"," and "," mod ","=")+"]";};var Selector=Base.extend({constructor:function(selector){this.toString=K(trim(selector));},exec:function(context,single){return Selector.parse(this)(context,single);},test:function(element){var selector=new Selector(this+"[b2-test]");element.setAttribute("b2-test",true);var result=selector.exec(Traversal.getOwnerDocument(element),true);element.removeAttribute("b2-test");return result==element;},toXPath:function(){return Selector.toXPath(this);},"@(XPathResult)":{exec:function(context,single){if(_NOT_XPATH.test(this)){return this.base(context,single);}
var document=Traversal.getDocument(context);var type=single?9:7;var result=document.evaluate(this.toXPath(),context,null,type,null);return single?result.singleNodeValue:result;}},"@MSIE":{exec:function(context,single){if(typeof context.selectNodes!="undefined"&&!_NOT_XPATH.test(this)){var method=single?"selectSingleNode":"selectNodes";return context[method](this.toXPath());}
return this.base(context,single);}},"@(true)":{exec:function(context,single){try{var result=this.base(context||document,single);}catch(error){throw new SyntaxError(format("'%1' is not a valid CSS selector.",this));}
return single?result:new StaticNodeList(result);}}},{toXPath:function(selector){if(!_xpathParser)_xpathParser=new XPathParser;return _xpathParser.parse(selector);}});var _NOT_XPATH=":(checked|disabled|enabled|contains)|^(#[\\w-]+\\s*)?\\w+$";if(detect("KHTML")){if(detect("WebKit5")){_NOT_XPATH+="|nth\\-|,";}else{_NOT_XPATH=".";}}
_NOT_XPATH=new RegExp(_NOT_XPATH);var _OPERATORS={"=":"%1=='%2'","!=":"%1!='%2'","~=":/(^| )%1( |$)/,"|=":/^%1(-|$)/,"^=":/^%1/,"$=":/%1$/,"*=":/%1/};_OPERATORS[""]="%1!=null";var _PSEUDO_CLASSES={"checked":"e%1.checked","contains":"e%1[TEXT].indexOf('%2')!=-1","disabled":"e%1.disabled","empty":"Traversal.isEmpty(e%1)","enabled":"e%1.disabled===false","first-child":"!Traversal.getPreviousElementSibling(e%1)","last-child":"!Traversal.getNextElementSibling(e%1)","only-child":"!Traversal.getPreviousElementSibling(e%1)&&!Traversal.getNextElementSibling(e%1)","root":"e%1==Traversal.getDocument(e%1).documentElement"};var _INDEXED=detect("(element.sourceIndex)");var _VAR="var p%2=0,i%2,e%2,n%2=e%1.";var _ID=_INDEXED?"e%1.sourceIndex":"assignID(e%1)";var _TEST="var g="+_ID+";if(!p[g]){p[g]=1;";var _STORE="r[r.length]=e%1;if(s)return e%1;";var _FN="var _selectorFunction=function(e0,s){_indexed++;var r=[],p={},reg=[%1],"+"d=Traversal.getDocument(e0),c=d.body?'toUpperCase':'toString';";var _xpathParser;var _reg;var _index;var _wild;var _list;var _duplicate;var _cache={};var _parser=new CSSParser({"^ \\*:root":function(match){_wild=false;var replacement="e%2=d.documentElement;if(Traversal.contains(e%1,e%2)){";return format(replacement,_index++,_index);}," (\\*|[\\w-]+)#([\\w-]+)":function(match,tagName,id){_wild=false;var replacement="var e%2=_byId(d,'%4');if(e%2&&";if(tagName!="*")replacement+="e%2.nodeName=='%3'[c]()&&";replacement+="Traversal.contains(e%1,e%2)){";if(_list)replacement+=format("i%1=n%1.length;",_list);return format(replacement,_index++,_index,tagName,id);}," (\\*|[\\w-]+)":function(match,tagName){_duplicate++;_wild=tagName=="*";var replacement=_VAR;replacement+=(_wild&&_MSIE5)?"all":"getElementsByTagName('%3')";replacement+=";for(i%2=0;(e%2=n%2[i%2]);i%2++){";return format(replacement,_index++,_list=_index,tagName);},">(\\*|[\\w-]+)":function(match,tagName){var children=_MSIE&&_list;_wild=tagName=="*";var replacement=_VAR;replacement+=children?"children":"childNodes";if(!_wild&&children)replacement+=".tags('%3')";replacement+=";for(i%2=0;(e%2=n%2[i%2]);i%2++){";if(_wild){replacement+="if(e%2.nodeType==1){";_wild=_MSIE5;}else{if(!children)replacement+="if(e%2.nodeName=='%3'[c]()){";}
return format(replacement,_index++,_list=_index,tagName);},"\\+(\\*|[\\w-]+)":function(match,tagName){var replacement="";if(_wild&&_MSIE)replacement+="if(e%1.nodeName!='!'){";_wild=false;replacement+="e%1=Traversal.getNextElementSibling(e%1);if(e%1";if(tagName!="*")replacement+="&&e%1.nodeName=='%2'[c]()";replacement+="){";return format(replacement,_index,tagName);},"~(\\*|[\\w-]+)":function(match,tagName){var replacement="";if(_wild&&_MSIE)replacement+="if(e%1.nodeName!='!'){";_wild=false;_duplicate=2;replacement+="while(e%1=e%1.nextSibling){if(e%1.b2_adjacent==_indexed)break;if(";if(tagName=="*"){replacement+="e%1.nodeType==1";if(_MSIE5)replacement+="&&e%1.nodeName!='!'";}else replacement+="e%1.nodeName=='%2'[c]()";replacement+="){e%1.b2_adjacent=_indexed;";return format(replacement,_index,tagName);},"#([\\w-]+)":function(match,id){_wild=false;var replacement="if(e%1.id=='%2'){";if(_list)replacement+=format("i%1=n%1.length;",_list);return format(replacement,_index,id);},"\\.([\\w-]+)":function(match,className){_wild=false;_reg.push(new RegExp("(^|\\s)"+rescape(className)+"(\\s|$)"));return format("if(e%1.className&&reg[%2].test(e%1.className)){",_index,_reg.length-1);},":not\\((\\*|[\\w-]+)?([^)]*)\\)":function(match,tagName,filters){var replacement=(tagName&&tagName!="*")?format("if(e%1.nodeName=='%2'[c]()){",_index,tagName):"";replacement+=_parser.exec(filters);return"if(!"+replacement.slice(2,-1).replace(/\)\{if\(/g,"&&")+"){";},":nth(-last)?-child\\(([^)]+)\\)":function(match,last,args){_wild=false;last=format("e%1.parentNode.b2_length",_index);var replacement="if(p%1!==e%1.parentNode)p%1=_register(e%1.parentNode);";replacement+="var i=e%1[p%1.b2_lookup];if(p%1.b2_lookup!='b2_index')i++;if(";return format(replacement,_index)+_nthChild(match,args,"i",last,"!","&&","%","==")+"){";},":([\\w-]+)(\\(([^)]+)\\))?":function(match,pseudoClass,$2,args){return"if("+format(_PSEUDO_CLASSES[pseudoClass]||"throw",_index,args||"")+"){";},"\\[([\\w-]+)\\s*([^=]?=)?\\s*([^\\]]*)\\]":function(match,attr,operator,value){var alias=_ATTRIBUTES[attr]||attr;if(operator){var getAttribute="e%1.getAttribute('%2',2)";if(!_EVALUATED.test(attr)){getAttribute="e%1.%3||"+getAttribute;}
attr=format("("+getAttribute+")",_index,attr,alias);}else{attr=format("Element.getAttribute(e%1,'%2')",_index,attr);}
var replacement=_OPERATORS[operator||""];if(instanceOf(replacement,RegExp)){_reg.push(new RegExp(format(replacement.source,rescape(_parser.unescape(value)))));replacement="reg[%2].test(%1)";value=_reg.length-1;}
return"if("+format(replacement,attr,value)+"){";}});new function(_){var _byId=_MSIE?function(document,id){var result=document.all[id]||null;if(!result||result.id==id)return result;for(var i=0;i<result.length;i++){if(result[i].id==id)return result[i];}
return null;}:function(document,id){return document.getElementById(id);};var _indexed=1;function _register(element){if(element.rows){element.b2_length=element.rows.length;element.b2_lookup="rowIndex";}else if(element.cells){element.b2_length=element.cells.length;element.b2_lookup="cellIndex";}else if(element.b2_indexed!=_indexed){var index=0;var child=element.firstChild;while(child){if(child.nodeType==1&&child.nodeName!="!"){child.b2_index=++index;}
child=child.nextSibling;}
element.b2_length=index;element.b2_lookup="b2_index";}
element.b2_indexed=_indexed;return element;};Selector.parse=function(selector){if(!_cache[selector]){_reg=[];var fn="";var selectors=_parser.escape(selector).split(",");for(var i=0;i<selectors.length;i++){_wild=_index=_list=0;_duplicate=selectors.length>1?2:0;var block=_parser.exec(selectors[i])||"throw;";if(_wild&&_MSIE){block+=format("if(e%1.nodeName!='!'){",_index);}
var store=(_duplicate>1)?_TEST:"";block+=format(store+_STORE,_index);block+=Array(match(block,/\{/g).length+1).join("}");fn+=block;}
eval(format(_FN,_reg)+_parser.unescape(fn)+"return s?null:r}");_cache[selector]=_selectorFunction;}
return _cache[selector];};};Document.implement(DocumentSelector);Element.implement(ElementSelector);var HTMLDocument=Document.extend(null,{"@(document.activeElement===undefined)":{bind:function(document){document.activeElement=null;EventTarget.addEventListener(document,"focus",function(event){document.activeElement=event.target;},false);return this.base(document);}}});var HTMLElement=Element.extend({addClass:function(element,className){if(!this.hasClass(element,className)){element.className+=(element.className?" ":"")+className;}},hasClass:function(element,className){var regexp=new RegExp("(^|\\s)"+className+"(\\s|$)");return regexp.test(element.className);},removeClass:function(element,className){var regexp=new RegExp("(^|\\s)"+className+"(\\s|$)","g");element.className=trim(element.className.replace(regexp,"$2"));},toggleClass:function(element,className){if(this.hasClass(element,className)){this.removeClass(element,className);}else{this.addClass(element,className);}}},{bindings:{},tags:"*",bind:function(element){CSSStyleDeclaration.bind(element.style);return this.base(element);},extend:function(){var binding=base(this,arguments);var tags=(binding.tags||"").toUpperCase().split(",");forEach(tags,function(tagName){HTMLElement.bindings[tagName]=binding;});return binding;},"@!(element.ownerDocument)":{bind:function(element){element.ownerDocument=Traversal.getOwnerDocument(element);return this.base(element);}}});HTMLElement.extend(null,{tags:"APPLET,EMBED",bind:I});eval(this.exports);};if(navigator.appVersion.search(/Safari/)!=-1)
{NodeList.prototype.forEach=function(a,b){for(var i=0;i<this.length;i++){a.call(b,this.item(i),i,this);}};}
if(typeof(base2)=="undefined"){throw new Error("Base2 not found. wForms 3.0 depends on the base2 library.");}
if(typeof(wFORMS)=="undefined"){wFORMS={};}
wFORMS.NAME="wFORMS";wFORMS.VERSION="3.0";wFORMS.__repr__=function(){return"["+this.NAME+" "+this.VERSION+"]";};wFORMS.toString=function(){return this.__repr__();};wFORMS.behaviors={};wFORMS.helpers={}
wFORMS.instances=[];wFORMS.helpers.randomId=function(){var seed=(new Date()).getTime();seed=seed.toString().substr(6);for(var i=0;i<6;i++)
seed+=String.fromCharCode(48+Math.floor((Math.random()*10)));return"id_"+seed;}
wFORMS.helpers.getFieldValue=function(element){switch(element.tagName){case"INPUT":if(element.type=='checkbox')
return element.checked?element.value:null;if(element.type=='radio')
return element.checked?element.value:null;return element.value;break;case"SELECT":if(element.selectedIndex==-1){return null;}
if(element.getAttribute('multiple')){var v=[];for(var i=0;i<element.options.length;i++){if(element.options[i].selected){v.push(element.options[i].value);}}
return v;}
return element.options[element.selectedIndex].value;break;case"TEXTAREA":return element.value;break;default:return null;break;}}
wFORMS.helpers.getComputedStyle=function(element,styleName){return document.defaultView.getComputedStyle(element,"").getPropertyValue(styleName);}
wFORMS.helpers.getLeft=function(elem){var pos=0;while(elem.offsetParent){try{if(document.defaultView.getComputedStyle(elem,"").getPropertyValue('position')=='relative'){return pos;}
if(pos>0&&document.defaultView.getComputedStyle(elem,"").getPropertyValue('position')=='absolute'){return pos;}}catch(x){}
pos+=elem.offsetLeft;elem=elem.offsetParent;}
if(!window.opera&&document.all&&document.compatMode&&document.compatMode!="BackCompat"){pos+=parseInt(document.body.currentStyle.marginTop);}
return pos;}
wFORMS.helpers.getTop=function(elem){var pos=0;while(elem.offsetParent){try{if(document.defaultView.getComputedStyle(elem,"").getPropertyValue('position')=='relative'){return pos;}
if(pos>0&&document.defaultView.getComputedStyle(elem,"").getPropertyValue('position')=='absolute'){return pos;}}catch(x){}
pos+=elem.offsetTop;elem=elem.offsetParent;}
if(!window.opera&&document.all&&document.compatMode&&document.compatMode!="BackCompat"){pos+=parseInt(document.body.currentStyle.marginLeft)+1;}
return pos;}
wFORMS.helpers.useSpotlight=false;wFORMS.helpers.spotlight=function(target){}
wFORMS.helpers.activateStylesheet=function(sheetref){if(document.getElementsByTagName){var ss=document.getElementsByTagName('link');}else if(document.styleSheets){var ss=document.styleSheets;}
for(var i=0;ss[i];i++){if(ss[i].href.indexOf(sheetref)!=-1){ss[i].disabled=true;ss[i].disabled=false;}}}
wFORMS.helpers.contains=function(array,needle){var l=array.length;for(var i=0;i<l;i++){if(array[i]===needle){return true;}}
return false;}
wFORMS.onLoadHandler=function(){var forms=document.getElementsByTagName("FORM");for(var i=0;i<forms.length;i++){if(forms[i].getAttribute('rel')!='no-behavior')
wFORMS.applyBehaviors(forms[i]);}}
wFORMS.applyBehaviors=function(f){if(!f.querySelectorAll){base2.DOM.bind(f);}
if(wFORMS.behaviors['switch']){var b=wFORMS.behaviors['switch'].applyTo(f);if(!wFORMS.instances['switch']){wFORMS.instances['switch']=[b];}else{wFORMS.removeBehavior(f,'switch');wFORMS.instances['switch'].push(b);}}
for(var behaviorName in wFORMS.behaviors){if(behaviorName=='switch'){continue;}
if(wFORMS.behaviors[behaviorName].applyTo){var b=wFORMS.behaviors[behaviorName].applyTo(f);if(b&&b.constructor!=Array){b=[b];}
for(var i=0;b&&i<b.length;i++){if(!wFORMS.instances[behaviorName]){wFORMS.instances[behaviorName]=[b[i]];}else{wFORMS.removeBehavior(f,behaviorName);wFORMS.instances[behaviorName].push(b[i]);}}}}
if(wFORMS.behaviors.onApplyAll){wFORMS.behaviors.onApplyAll(f);}}
wFORMS.removeBehavior=function(f,behaviorName){return null;if(!wFORMS.instances[behaviorName])
return null;for(var i=0;i<wFORMS.instances[behaviorName].length;i++){if(wFORMS.instances[behaviorName][i].target==f){wFORMS.instances[behaviorName][i]=null;}}
return null;}
wFORMS.getBehaviorInstance=function(f,behaviorName){if(!f||!wFORMS.instances[behaviorName])
return null;for(var i=0;i<wFORMS.instances[behaviorName].length;i++){if(wFORMS.instances[behaviorName][i].target==f){return wFORMS.instances[behaviorName][i];}}
return null;}
base2.DOM.Element.addEventListener(document,'DOMContentLoaded',wFORMS.onLoadHandler,false);wFORMS.helpers.activateStylesheet('wforms-jsonly.css');if(typeof(wFORMS)=="undefined"){throw new Error("wFORMS core not found. This behavior depends on the wFORMS core.");}
wFORMS.behaviors.hint={CSS_INACTIVE:'field-hint-inactive',CSS_ACTIVE:'field-hint',HINT_SELECTOR:'*[id$="-H"]',HINT_SUFFIX:'-H',instance:function(f){this.behavior=wFORMS.behaviors.hint;this.target=f;}}
wFORMS.behaviors.hint.applyTo=function(f){var b=new wFORMS.behaviors.hint.instance(f);f.querySelectorAll(wFORMS.behaviors.hint.HINT_SELECTOR).forEach(function(elem){var e=b.getElementByHintId(elem.id);if(e){if(!e.addEventListener)base2.DOM.bind(e);if(e.tagName=="SELECT"||e.tagName=="TEXTAREA"||(e.tagName=="INPUT"&&e.type!="radio"&&e.type!="checkbox")){e.addEventListener('focus',function(event){b.run(event,this)},false);e.addEventListener('blur',function(event){b.run(event,this)},false);}else{e.addEventListener('mouseover',function(event){b.run(event,e)},false);e.addEventListener('mouseout',function(event){b.run(event,e)},false);}}});b.onApply();return b;}
wFORMS.behaviors.hint.instance.prototype.onApply=function(){}
wFORMS.behaviors.hint.instance.prototype.run=function(event,element){var hint=this.getHintElement(element);if(!hint)return;if(event.type=='focus'||event.type=='mouseover'){hint.removeClass(wFORMS.behaviors.hint.CSS_INACTIVE)
hint.addClass(wFORMS.behaviors.hint.CSS_ACTIVE);this.setup(hint,element);}else{hint.addClass(wFORMS.behaviors.hint.CSS_INACTIVE);hint.removeClass(wFORMS.behaviors.hint.CSS_ACTIVE);}}
wFORMS.behaviors.hint.instance.prototype.getElementByHintId=function(hintId){var id=hintId.substr(0,hintId.length-wFORMS.behaviors.hint.HINT_SUFFIX.length);var e=document.getElementById(id);return e;}
wFORMS.behaviors.hint.instance.prototype.getHintElement=function(element){var e=document.getElementById(element.id+this.behavior.HINT_SUFFIX);if(e&&!e.hasClass){base2.DOM.bind(e);}
return e&&e!=''?e:null;}
wFORMS.behaviors.hint.instance.prototype.setup=function(hint,source){var l=((source.tagName=='SELECT'?+source.offsetWidth:0)+wFORMS.helpers.getLeft(source));var t=(wFORMS.helpers.getTop(source)+source.offsetHeight);hint.style.left=l+"px";hint.style.top=t+"px";}
wFORMS.behaviors.hint.isHintId=function(id){return id.match(new RegExp(wFORMS.behaviors.hint.HINT_SUFFIX+'$'))!=null;}
if(typeof(wFORMS)=="undefined"){throw new Error("wFORMS core not found. This behavior depends on the wFORMS core.");}
wFORMS.behaviors.paging={SELECTOR:'.wfPage',CSS_PAGE:'wfPage',CSS_CURRENT_PAGE:'wfCurrentPage',CSS_BUTTON_NEXT:'wfPageNextButton',CSS_BUTTON_PREVIOUS:'wfPagePreviousButton',CSS_BUTTON_PLACEHOLDER:'wfPagingButtons',ID_BUTTON_NEXT_PREFIX:'wfPageNextId',ID_BUTTON_PREVIOUS_PREFIX:'wfPagePreviousId',CSS_SUBMIT_HIDDEN:'wfHideSubmit',ID_PAGE_PREFIX:'wfPgIndex-',ID_PLACEHOLDER_SUFFIX:'-buttons',ATTR_INDEX:'wfPageIndex_activate',MESSAGES:{CAPTION_NEXT:'Next Page',CAPTION_PREVIOUS:'Previous Page'},runValidationOnPageNext:true,onPageNext:function(){},onPagePrevious:function(){},onPageChange:function(){},instance:function(f){this.behavior=wFORMS.behaviors.paging;this.target=f;this.currentPageIndex=1;}}
wFORMS.behaviors.paging.applyTo=function(f){var b=new wFORMS.behaviors.paging.instance(f)
var behavior=wFORMS.behaviors.paging;var isValidationAccepted=(wFORMS.behaviors.validation&&wFORMS.behaviors.paging.runValidationOnPageNext);var isPagingApplied=false;f.querySelectorAll(wFORMS.behaviors.paging.SELECTOR).forEach(function(elem){isPagingApplied=true;var ph=b.getOrCreatePlaceHolder(elem);var index=wFORMS.behaviors.paging.getPageIndex(elem);if(index==1){var ctrl=base2.DOM.bind(ph.appendChild(behavior._createNextPageButton(index)));if(isValidationAccepted){ctrl.addEventListener('click',function(event){var v=wFORMS.getBehaviorInstance(b.target,'validation');if(v.run(event,elem)){b.run(event,ctrl);}},false);}else{ctrl.addEventListener('click',function(event){b.run(event,ctrl);},false);}
wFORMS.behaviors.paging.showPage(elem);}else{var ctrl=base2.DOM.bind(behavior._createPreviousPageButton(index));ph.insertBefore(ctrl,ph.firstChild);ctrl.addEventListener('click',function(event){b.run(event,ctrl)},false);if(!wFORMS.behaviors.paging.isLastPageIndex(index,true)){var _ctrl=base2.DOM.bind(ph.appendChild(behavior._createNextPageButton(index)));if(isValidationAccepted){_ctrl.addEventListener('click',function(event){var v=wFORMS.getBehaviorInstance(b.target,'validation');if(v.run(event,elem)){b.run(event,_ctrl);}},false);}else{_ctrl.addEventListener('click',function(event){b.run(event,_ctrl);},false);}}}});if(isPagingApplied){p=b.findNextPage(0);b.currentPageIndex=0;b.activatePage(wFORMS.behaviors.paging.getPageIndex(p),false);b.onApply();}
base2.DOM.Element.addEventListener(f,'submit',function(e){b.onSubmit(e,b)});return b;}
wFORMS.behaviors.paging.instance.prototype.onApply=function(){}
wFORMS.behaviors.paging.instance.prototype.onSubmit=function(e,b){if(!wFORMS.behaviors.paging.isLastPageIndex(b.currentPageIndex)){var nextPage=b.findNextPage(b.currentPageIndex);e.preventDefault();b.activatePage(b.currentPageIndex+1);var first=base2.DOM.Element.querySelector(nextPage,'input, textarea, select');if(first){first.focus();}}}
wFORMS.behaviors.paging.getPageIndex=function(elem){if(elem&&elem.id){var index=elem.id.replace(new RegExp(wFORMS.behaviors.paging.ID_PAGE_PREFIX+'(\\d+)'),"$1");index=parseInt(index);return!isNaN(index)?index:false;}
return false;}
wFORMS.behaviors.paging.isElementVisible=function(element){while(element&&element.tagName!='BODY'){if(element.className){if(element.className.indexOf(this.CSS_CURRENT_PAGE)!=-1){return true;}
if(element.className.indexOf(this.CSS_PAGE)!=-1){return false;}}
element=element.parentNode;}
return true;}
wFORMS.behaviors.paging._createNextPageButton=function(index){var elem=this.createNextPageButton();elem.setAttribute(this.ATTR_INDEX,index+1);elem.id=this.ID_BUTTON_NEXT_PREFIX+index;return elem;}
wFORMS.behaviors.paging.createNextPageButton=function(){var elem=document.createElement('input');elem.setAttribute('value',this.MESSAGES.CAPTION_NEXT);elem.type='button';elem.className=this.CSS_BUTTON_NEXT;return elem;}
wFORMS.behaviors.paging._createPreviousPageButton=function(index){var elem=this.createPreviousPageButton();elem.setAttribute(this.ATTR_INDEX,index-1);elem.id=this.ID_BUTTON_PREVIOUS_PREFIX+index;;return elem;}
wFORMS.behaviors.paging.createPreviousPageButton=function(){var elem=document.createElement('input');elem.setAttribute('value',this.MESSAGES.CAPTION_PREVIOUS);elem.type='button';elem.className=this.CSS_BUTTON_PREVIOUS;return elem;}
wFORMS.behaviors.paging.instance.prototype.getOrCreatePlaceHolder=function(pageElem){var id=pageElem.id+this.behavior.ID_PLACEHOLDER_SUFFIX;var elem=document.getElementById(id);if(!elem){elem=pageElem.appendChild(document.createElement('div'));elem.id=id;elem.className=this.behavior.CSS_BUTTON_PLACEHOLDER;}
return elem;}
wFORMS.behaviors.paging.hidePage=function(e){if(e){if(!e.removeClass){e.removeClass=function(className){return base2.DOM.HTMLElement.removeClass(this,className)};}
if(!e.addClass){e.addClass=function(className){return base2.DOM.HTMLElement.addClass(this,className)};}
e.removeClass(wFORMS.behaviors.paging.CSS_CURRENT_PAGE);e.addClass(wFORMS.behaviors.paging.CSS_PAGE);}}
wFORMS.behaviors.paging.showPage=function(e){if(e){if(!e.removeClass){e.removeClass=function(className){return base2.DOM.HTMLElement.removeClass(this,className)};}
e.removeClass(wFORMS.behaviors.paging.CSS_PAGE);if(!e.addClass){e.addClass=function(className){return base2.DOM.HTMLElement.addClass(this,className)};}
e.addClass(wFORMS.behaviors.paging.CSS_CURRENT_PAGE);}}
wFORMS.behaviors.paging.instance.prototype.activatePage=function(index){if(arguments.length>1){var scrollIntoView=arguments[1];}else{var scrollIntoView=true;}
if(index==this.currentPageIndex){return false;}
index=parseInt(index);if(index>this.currentPageIndex){var p=this.findNextPage(this.currentPageIndex);}else{var p=this.findPreviousPage(this.currentPageIndex);}
if(p){var _self=this;var index=_self.behavior.getPageIndex(p);_self.setupManagedControls(index);_self.behavior.hidePage(_self.behavior.getPageByIndex(_self.currentPageIndex));_self.behavior.showPage(p);var _currentPageIndex=_self.currentPageIndex;_self.currentPageIndex=index;if(scrollIntoView){if(p.scrollIntoView){p.scrollIntoView();}
else{location.hash="#"+wFORMS.behaviors.paging.ID_PAGE_PREFIX+index;}}
_self.behavior.onPageChange(p);if(index>_currentPageIndex){_self.behavior.onPageNext(p);}else{_self.behavior.onPagePrevious(p);}}}
wFORMS.behaviors.paging.instance.prototype.setupManagedControls=function(index){if(!index){index=this.currentPageIndex;}
var b=wFORMS.behaviors.paging;if(b.isFirstPageIndex(index)){if(ctrl=b.getPreviousButton(index)){ctrl.style.visibility='hidden';}}else{if(ctrl=b.getPreviousButton(index)){ctrl.style.visibility='visible';}}
if(b.isLastPageIndex(index)){if(ctrl=b.getNextButton(index)){ctrl.style.visibility='hidden';}
this.showSubmitButtons();}else{if(ctrl=b.getNextButton(index)){ctrl.style.visibility='visible';}
this.hideSubmitButtons();}}
wFORMS.behaviors.paging.instance.prototype.showSubmitButtons=function(){var nl=this.target.getElementsByTagName('input');for(var i=0;i<nl.length;i++){if(nl[i].type=='submit'){nl[i].className=nl[i].className.replace(new RegExp("(^|\\s)"+this.behavior.CSS_SUBMIT_HIDDEN+"(\\s|$)","g"),"$2");}}}
wFORMS.behaviors.paging.instance.prototype.hideSubmitButtons=function(){var nl=this.target.getElementsByTagName('input');for(var i=0;i<nl.length;i++){if(nl[i].type=='submit'){if(!(new RegExp("(^|\\s)"+this.behavior.CSS_SUBMIT_HIDDEN+"(\\s|$)")).test(nl[i].className)){nl[i].className+=' '+this.behavior.CSS_SUBMIT_HIDDEN;}}}}
wFORMS.behaviors.paging.getPageByIndex=function(index){var page=document.getElementById(wFORMS.behaviors.paging.ID_PAGE_PREFIX+index);return page?base2.DOM.bind(page):false;}
wFORMS.behaviors.paging.getNextButton=function(index){return document.getElementById(wFORMS.behaviors.paging.ID_BUTTON_NEXT_PREFIX+index);}
wFORMS.behaviors.paging.getPreviousButton=function(index){return document.getElementById(wFORMS.behaviors.paging.ID_BUTTON_PREVIOUS_PREFIX+index);}
wFORMS.behaviors.paging.isLastPageIndex=function(index,ignoreSwitch){index=parseInt(index)+1;var b=wFORMS.behaviors.paging;var p=b.getPageByIndex(index);if((_b=wFORMS.behaviors['switch'])&&!ignoreSwitch){while(p&&_b.isSwitchedOff(p)){index++;p=b.getPageByIndex(index);}}
return p?false:true;}
wFORMS.behaviors.paging.isFirstPageIndex=function(index,ignoreSwitch){index=parseInt(index)-1;var b=wFORMS.behaviors.paging;var p=b.getPageByIndex(index);if((_b=wFORMS.behaviors['switch'])&&!ignoreSwitch){while(p&&_b.isSwitchedOff(p)){index--;p=b.getPageByIndex(index);}}
return p?false:true;}
wFORMS.behaviors.paging.instance.prototype.findNextPage=function(index){index=parseInt(index)+1;var b=wFORMS.behaviors.paging;var p=b.getPageByIndex(index);if(_b=wFORMS.behaviors['switch']){while(p&&_b.isSwitchedOff(p)){index++;p=b.getPageByIndex(index);}}
return p;}
wFORMS.behaviors.paging.instance.prototype.findPreviousPage=function(index){index=parseInt(index)-1;var b=wFORMS.behaviors.paging;var p=b.getPageByIndex(index);if(_b=wFORMS.behaviors['switch']){while(p&&_b.isSwitchedOff(p)){index--;p=b.getPageByIndex(index);}}
return p?p:false;}
wFORMS.behaviors.paging.instance.prototype.run=function(e,element){this.activatePage(element.getAttribute(wFORMS.behaviors.paging.ATTR_INDEX));}
if(typeof(wFORMS)=="undefined"){throw new Error("wFORMS core not found. This behavior depends on the wFORMS core.");}
wFORMS.behaviors.repeat={SELECTOR_REPEAT:'*[class~="repeat"]',SELECTOR_REMOVEABLE:'*[class~="removeable"]',ID_SUFFIX_DUPLICATE_LINK:'-wfDL',ID_SUFFIX_COUNTER:'-RC',CSS_DUPLICATE_LINK:'duplicateLink',CSS_DUPLICATE_SPAN:'duplicateSpan',CSS_DELETE_LINK:'removeLink',CSS_DELETE_SPAN:'removeSpan',CSS_REMOVEABLE:'removeable',CSS_REPEATABLE:'repeat',ATTR_DUPLICATE:'wfr__dup',ATTR_DUPLICATE_ELEM:'wfr__dup_elem',ATTR_HANDLED:'wfr_handled',ATTR_MASTER_SECTION:'wfr__master_sec',ATTR_LINK_SECTION_ID:'wfr_sec_id',MESSAGES:{ADD_CAPTION:"Add another response",ADD_TITLE:"Will duplicate this question or section.",REMOVE_CAPTION:"Remove",REMOVE_TITLE:"Will remove this question or section"},UPDATEABLE_ATTR_ARRAY:['id','name','for'],preserveRadioName:false,CSS_PRESERVE_RADIO_NAME:"preserveRadioName",onRepeat:function(elem){},onRemove:function(elem){},allowRepeat:function(elem,b){return true;},instance:function(f){this.behavior=wFORMS.behaviors.repeat;this.target=f;}}
var _b=wFORMS.behaviors.repeat;var _i=wFORMS.behaviors.repeat.instance;_b.applyTo=function(f){var _self=this;var b=new Array();if(!f.querySelectorAll)base2.DOM.bind(f);f.querySelectorAll(this.SELECTOR_REPEAT).forEach(function(elem){if(_self.isHandled(elem)){return;}
if(!elem.id)elem.id=wFORMS.helpers.randomId();var _b=new _self.instance(elem);var e=_b.getOrCreateRepeatLink(elem);e.addEventListener('click',function(event){_b.run(event,e)},false);_b.setElementHandled(elem);b.push(_b);});if(!f.hasClass){f=base2.DOM.bind(f);}
if(f.hasClass(this.CSS_REMOVEABLE)){var m=this.getMasterSection(f);var _i=wFORMS.getBehaviorInstance(m,'repeat');if(_i){_i.getOrCreateRemoveLink(f);}else if(b[0]){b[0].getOrCreateRemoveLink(f);}}
f.querySelectorAll(this.SELECTOR_REMOVEABLE).forEach(function(e){var m=wFORMS.behaviors.repeat.getMasterSection(e);var _i=wFORMS.getBehaviorInstance(m,'repeat');if(_i){_i.getOrCreateRemoveLink(e);}else if(b[0]){b[0].getOrCreateRemoveLink(e);}});for(var i=0;i<b.length;i++){b[i].onApply();}
return b;}
_i.prototype.onApply=function(){}
_i.prototype.getOrCreateRepeatLink=function(elem){var id=elem.id+this.behavior.ID_SUFFIX_DUPLICATE_LINK;var e=document.getElementById(id);if(!e||e==''){e=this.createRepeatLink(id);var spanElem=document.createElement('span');spanElem.className=this.behavior.CSS_DUPLICATE_SPAN;e=spanElem.appendChild(e);if(elem.tagName.toUpperCase()=='TR'){var tdElem=elem.getElementsByTagName('TD');if(!tdElem){tdElem=elem.appendChild(document.createElement('TD'));}else{tdElem=tdElem[tdElem.length-1];}
tdElem.appendChild(spanElem);}else{elem.appendChild(spanElem)}}
return base2.DOM.bind(e);}
_i.prototype.createRepeatLink=function(id){var linkElem=document.createElement("A");linkElem.id=id;linkElem.setAttribute('href','#');linkElem.className=this.behavior.CSS_DUPLICATE_LINK;linkElem.setAttribute('title',this.behavior.MESSAGES.ADD_TITLE);linkElem.appendChild(document.createElement('span').appendChild(document.createTextNode(this.behavior.MESSAGES.ADD_CAPTION)));return linkElem;}
_i.prototype.getOrCreateRemoveLink=function(elem){var e=this.createRemoveLink(elem.id);if(elem.tagName=='TR'){var tds=elem.getElementsByTagName('TD');var tdElem=tds[tds.length-1];tdElem.appendChild(e);}else{elem.appendChild(e)}}
_i.prototype.createRemoveLink=function(id){var linkElem=document.createElement("a");linkElem.id=id+this.behavior.ID_SUFFIX_DUPLICATE_LINK;linkElem.setAttribute('href','#');linkElem.className=this.behavior.CSS_DELETE_LINK;linkElem.setAttribute('title',this.behavior.MESSAGES.REMOVE_TITLE);linkElem.setAttribute(this.behavior.ATTR_LINK_SECTION_ID,id);var spanElem=document.createElement('span');spanElem.appendChild(document.createTextNode(this.behavior.MESSAGES.REMOVE_CAPTION));linkElem.appendChild(spanElem);var _self=this;linkElem.onclick=function(event){_self.onRemoveLinkClick(event,linkElem);};var spanElem=document.createElement('span');spanElem.className=this.behavior.CSS_DELETE_SPAN;spanElem.appendChild(linkElem);return spanElem;}
_i.prototype.duplicateSection=function(elem){if(!this.behavior.allowRepeat(elem,this)){return false;}
this.updateMasterSection(elem);var newElem=elem.cloneNode(true);var index=this.getNextDuplicateIndex(this.target);var suffix=this.createSuffix(elem,index);this.updateDuplicatedSection(newElem,index,suffix);newElem=elem.parentNode.insertBefore(newElem,this.getInsertNode(elem));wFORMS.applyBehaviors(newElem);if(wFORMS.behaviors.calculation)
{_c=wFORMS.behaviors.calculation;inputItem=newElem.querySelector('input');if(inputItem)
{if(inputItem.className.search(_c.VARIABLE_SELECTOR_PREFIX)!=-1)
_c.applyTo(inputItem.form);}}
this.behavior.onRepeat(newElem);wFORMS.helpers.spotlight(newElem);}
_i.prototype.removeSection=function(elem){if(elem){var elem=elem.parentNode.removeChild(elem);this.behavior.onRemove(elem);}}
_i.prototype.getInsertNode=function(elem){var insertNode=elem.nextSibling;if(insertNode&&insertNode.nodeType==1&&!insertNode.hasClass){insertNode=base2.DOM.bind(insertNode);}
while(insertNode&&(insertNode.nodeType==3||insertNode.hasClass(this.behavior.CSS_REMOVEABLE))){insertNode=insertNode.nextSibling;if(insertNode&&insertNode.nodeType==1&&!insertNode.hasClass){insertNode=base2.DOM.bind(insertNode);}}
return insertNode;}
_i.prototype.onRemoveLinkClick=function(event,link){var e=document.getElementById(link.getAttribute(this.behavior.ATTR_LINK_SECTION_ID));this.removeSection(e);if(event)event.preventDefault();}
_i.prototype.updateMasterSection=function(elem){if(elem.doItOnce==true)
return true;else
elem.doItOnce=true;var suffix=this.createSuffix(elem);elem.id=this.clearSuffix(elem.id)+suffix;this.updateMasterElements(elem,suffix);}
_i.prototype.updateMasterElements=function(elem,suffix){if(!elem||elem.nodeType!=1)
return;var cn=elem.childNodes;for(var i=0;i<cn.length;i++){var n=cn[i];if(n.nodeType!=1)continue;if(!n.hasClass){n.hasClass=function(className){return base2.DOM.HTMLElement.hasClass(this,className)};}
var siblingSuffix=suffix;if(n.hasClass(this.behavior.CSS_REPEATABLE)){suffix+="[0]";}
if(!n.hasClass(this.behavior.CSS_REMOVEABLE)){for(var j=0;j<this.behavior.UPDATEABLE_ATTR_ARRAY.length;j++){var attrName=this.behavior.UPDATEABLE_ATTR_ARRAY[j];var value=this.clearSuffix(n.getAttribute(attrName));if(!value){continue;}
if(attrName=='id'&&wFORMS.behaviors.hint&&wFORMS.behaviors.hint.isHintId(n.id)){n.id=value.replace(new RegExp("(.*)("+wFORMS.behaviors.hint.HINT_SUFFIX+')$'),"$1"+suffix+"$2");}else if(attrName=='id'&&wFORMS.behaviors.validation&&wFORMS.behaviors.validation.isErrorPlaceholderId(n.id)){n.id=value.replace(new RegExp("(.*)("+wFORMS.behaviors.validation.ERROR_PLACEHOLDER_SUFFIX+')$'),"$1"+suffix+"$2");}else if(attrName=='id'&&n.id.indexOf(this.behavior.ID_SUFFIX_DUPLICATE_LINK)!=-1){n.id=value.replace(new RegExp("(.*)("+this.behavior.ID_SUFFIX_DUPLICATE_LINK+')$'),"$1"+suffix+"$2");}else if(attrName=='id'){n.id=value+suffix;}else if(attrName=='name'){n.name=value+suffix;}else{n.setAttribute(attrName,value+suffix);}}
this.updateMasterElements(n,suffix);}
suffix=siblingSuffix;}}
_i.prototype.updateDuplicatedSection=function(elem,index,suffix){elem[this.behavior.ATTR_MASTER_SECTION]=elem.id;elem.id=this.clearSuffix(elem.id)+suffix;elem.className=elem.className.replace(this.behavior.CSS_REPEATABLE,this.behavior.CSS_REMOVEABLE);if(!elem.hasClass){elem.hasClass=function(className){return base2.DOM.HTMLElement.hasClass(this,className)};}
if(elem.hasClass(this.behavior.CSS_PRESERVE_RADIO_NAME))
var _preserveRadioName=true;else
var _preserveRadioName=this.behavior.preserveRadioName;this.updateSectionChildNodes(elem,suffix,_preserveRadioName);}
_i.prototype.updateSectionChildNodes=function(elem,suffix,preserveRadioName){var removeStack=new Array();var i=0;while(elem&&elem.childNodes&&elem.childNodes[i]){var e=elem.childNodes[i];i++;if(e.nodeType!=1){continue;}
if(!e.hasClass){e.hasClass=function(className){return base2.DOM.HTMLElement.hasClass(this,className)};}
if(this.behavior.isDuplicate(e)){removeStack.push(e);continue;}
if(e.hasClass(this.behavior.CSS_DUPLICATE_SPAN)){removeStack.push(e);continue;}
if(e.hasClass(this.behavior.CSS_DUPLICATE_LINK)){removeStack.push(e);continue;}
if(e.tagName=='INPUT'||e.tagName=='TEXTAREA'){if(e.type!='radio'&&e.type!='checkbox'){e.value='';}else{e.checked=false;}}
if(e.tagName=='INPUT'&&e.type=='radio'&&document.all&&!window.opera&&!preserveRadioName){var tagHtml="<INPUT type=\"radio\" name=\""+e.name+suffix+"\"></INPUT>";var fixedRadio=e.parentNode.insertBefore(document.createElement(tagHtml),e);e=e.parentNode.removeChild(e);fixedRadio.id=e.id;var l=this.behavior.UPDATEABLE_ATTR_ARRAY.length;for(var i=0;i<l;i++){var attrName=this.behavior.UPDATEABLE_ATTR_ARRAY[i];var value=e.getAttribute(attrName);fixedRadio.setAttribute(attrName,value);}
e=fixedRadio;if(!e.hasClass){e.hasClass=function(className){return base2.DOM.HTMLElement.hasClass(this,className)};}}
this.updateAttributes(e,suffix,preserveRadioName);if(e.hasClass(this.behavior.CSS_REPEATABLE)){this.updateSectionChildNodes(e,this.createSuffix(e),preserveRadioName);}else{this.updateSectionChildNodes(e,suffix,preserveRadioName);}}
for(var i=0;i<removeStack.length;i++){var e=removeStack[i];if(e.clearAttributes){e.clearAttributes(false);}
if(e.parentNode)e.parentNode.removeChild(e);}}
_i.prototype.createSuffix=function(e,index){var suffix='['+(index?index:'0')+']';var reg=/\[(\d+)\]$/;e=e.parentNode;while(e){if(!e.hasClass){e.hasClass=function(className){return base2.DOM.HTMLElement.hasClass(this,className)};}
if(e.hasClass(this.behavior.CSS_REPEATABLE)||e.hasClass(this.behavior.CSS_REMOVEABLE)){var idx=reg.exec(e.id);if(idx)idx=idx[1];suffix='['+(idx?idx:'0')+']'+suffix;}
e=e.parentNode;}
return suffix;}
_i.prototype.clearSuffix=function(value){if(!value){return;}
if(value.indexOf('[')!=-1){return value.substring(0,value.indexOf('['));}
return value;}
_i.prototype.updateAttributes=function(e,idSuffix,preserveRadioName){var isHint=wFORMS.behaviors.hint&&wFORMS.behaviors.hint.isHintId(e.id);var isErrorPlaceholder=wFORMS.behaviors.validation&&wFORMS.behaviors.validation.isErrorPlaceholderId(e.id);var isDuplicateLink=e.id.indexOf(this.behavior.ID_SUFFIX_DUPLICATE_LINK)!=-1;this.setInDuplicateGroup(e);if(this.behavior.isHandled(e)){this.removeHandled(e)}
if(wFORMS.behaviors['switch']&&wFORMS.behaviors['switch'].isHandled(e)){wFORMS.behaviors['switch'].removeHandle(e);}
var l=this.behavior.UPDATEABLE_ATTR_ARRAY.length;for(var i=0;i<l;i++){var attrName=this.behavior.UPDATEABLE_ATTR_ARRAY[i];var value=this.clearSuffix(e.getAttribute(attrName));if(!value){continue;}
if(attrName=='name'&&e.tagName=='INPUT'&&preserveRadioName){continue;}else if(isErrorPlaceholder&&attrName=='id'){e.id=value+idSuffix+wFORMS.behaviors.validation.ERROR_PLACEHOLDER_SUFFIX;}else if(isHint&&attrName=='id'){e.id=value+idSuffix+wFORMS.behaviors.hint.HINT_SUFFIX;}else if(isDuplicateLink&&attrName=='id'){e.id=value.replace(new RegExp("(.*)("+this.behavior.ID_SUFFIX_DUPLICATE_LINK+')$'),"$1"+idSuffix+"$2");}else if(attrName=='id'){e.id=value+idSuffix;}else if(attrName=='name'){e.name=value+idSuffix;}else{e.setAttribute(attrName,value+idSuffix);}}}
_i.prototype.getNextDuplicateIndex=function(elem){var c=this.getOrCreateCounterField(elem);var newValue=parseInt(c.value)+1;c.value=newValue;return newValue;}
_i.prototype.getOrCreateCounterField=function(elem){var cId=elem.id+this.behavior.ID_SUFFIX_COUNTER;var cElem=document.getElementById(cId);if(!cElem||cElem==''){cElem=this.createCounterField(cId);var formElem=elem.parentNode;while(formElem&&formElem.tagName.toUpperCase()!='FORM'){formElem=formElem.parentNode;}
formElem.appendChild(cElem);}
return cElem;}
_i.prototype.createCounterField=function(id){cElem=document.createElement('input');cElem.id=id;cElem.setAttribute('type','hidden');cElem.setAttribute('name',id);cElem.value='0';return cElem;}
_i.prototype.getSectionsCount=function(){if(this.behavior.isDuplicate(this.target)){return false;}
return parseInt(this.getOrCreateCounterField(this.target).value)+1;}
_i.prototype.setInDuplicateGroup=function(elem){return elem.setAttribute(this.behavior.ATTR_DUPLICATE_ELEM,true);}
_i.prototype.setElementHandled=function(elem){return elem.setAttribute(this.behavior.ATTR_HANDLED,true);}
_i.prototype.removeHandled=function(elem){return elem.removeAttribute(this.behavior.ATTR_HANDLED);}
_b.isDuplicate=function(elem){return elem.hasClass(this.CSS_REMOVEABLE);}
_b.isInDuplicateGroup=function(elem){return elem.getAttribute(this.ATTR_DUPLICATE_ELEM)?true:false;}
_b.isHandled=function(elem){return elem.getAttribute(this.ATTR_HANDLED);}
_b.getMasterSection=function(elem){if(!this.isDuplicate(elem))return false;return document.getElementById(elem[this.ATTR_MASTER_SECTION]);}
_i.prototype.run=function(e,element){this.duplicateSection(this.target);if(e)e.preventDefault();}
if(typeof(wFORMS)=="undefined"){throw new Error("wFORMS core not found. This behavior depends on the wFORMS core.");}
wFORMS.behaviors['switch']={SELECTOR:'*[class*="switch-"]',CSS_PREFIX:'switch-',CSS_OFFSTATE_PREFIX:'offstate-',CSS_ONSTATE_PREFIX:'onstate-',CSS_ONSTATE_FLAG:'swtchIsOn',CSS_OFFSTATE_FLAG:'swtchIsOff',onSwitchOn:function(elem){},onSwitchOff:function(elem){},onSwitch:function(form){},instance:function(f){this.behavior=wFORMS.behaviors['switch'];this.target=f;}}
wFORMS.behaviors['switch'].applyTo=function(f){var b=new wFORMS.behaviors['switch'].instance(f);f.querySelectorAll(wFORMS.behaviors['switch'].SELECTOR).forEach(function(elem){if(!elem.id){elem.id=wFORMS.helpers.randomId()}
switch(elem.tagName.toUpperCase()){case'OPTION':var sNode=elem.parentNode;while(sNode&&sNode.tagName!='SELECT'){sNode=sNode.parentNode;}
if(!sNode.addEventListener)
base2.DOM.bind(sNode);if(sNode&&!wFORMS.behaviors['switch'].isHandled(sNode)){sNode.addEventListener('change',function(event){b.run(event,sNode)},false);b.setupTargets(sNode);wFORMS.behaviors['switch'].handleElement(sNode);}
break;case'INPUT':if(elem.type&&elem.type.toUpperCase()=='RADIO'){if(!wFORMS.behaviors['switch'].isHandled(elem)){b.setupTargets(elem);}
var radioGroup=elem.form[elem.name];for(var i=radioGroup.length-1;i>=0;i--){var _elem=base2.DOM.bind(radioGroup[i]);if(!wFORMS.behaviors['switch'].isHandled(_elem)){_elem.addEventListener('click',function(event){b.run(event,_elem)},false);wFORMS.behaviors['switch'].handleElement(_elem);}}}else{elem.addEventListener('click',function(event){b.run(event,elem)},false);b.setupTargets(elem);}
break;default:elem.addEventListener('click',function(event){b.run(event,elem)},false);break;}});b.onApply();return b;}
wFORMS.behaviors['switch'].instance.prototype.onApply=function(){}
wFORMS.behaviors['switch'].isHandled=function(elem){return elem.getAttribute('rel')&&elem.getAttribute('rel').indexOf('wfHandled')>-1;}
wFORMS.behaviors['switch'].handleElement=function(elem){return elem.setAttribute('rel',(elem.getAttribute('rel')||"")+' wfHandled');}
wFORMS.behaviors['switch'].removeHandle=function(elem){if(attr=elem.getAttribute('rel')){if(attr=='wfHandled'){elem.removeAttribute('rel');}else if(attr.indexOf('wfHandled')!=-1){elem.setAttribute('rel',attr.replace(/(.*)( wfHandled)(.*)/,"$1$3"));}}}
wFORMS.behaviors['switch'].instance.prototype.getTriggersByElements=function(elems,includeSwitches){var o={ON:new Array(),OFF:new Array(),toString:function(){return"ON: "+this.ON+"\nOFF: "+this.OFF}};for(var i=0;i<elems.length;i++){var elem=elems[i];switch(elem.tagName.toUpperCase()){case'OPTION':if(elem.selected){o.ON=o.ON.concat(this.behavior.getSwitchNamesFromTrigger(elem,includeSwitches));}else{o.OFF=o.OFF.concat(this.behavior.getSwitchNamesFromTrigger(elem,includeSwitches));}
break;case'SELECT':for(var j=0;j<elem.options.length;j++){var opt=elem.options.item(j);if(opt.selected){o.ON=o.ON.concat(this.behavior.getSwitchNamesFromTrigger(opt,includeSwitches));}else{o.OFF=o.OFF.concat(this.behavior.getSwitchNamesFromTrigger(opt,includeSwitches));}}
break;case'INPUT':if(elem.type&&elem.type.toUpperCase()=='RADIO'){var radioGroup=elem.form[elem.name];if(!radioGroup)break;for(var j=radioGroup.length-1;j>=0;j--){var _elem=radioGroup[j];if(_elem==elem||!wFORMS.helpers.contains(elems,_elem)){if(_elem.checked){o.ON=o.ON.concat(this.behavior.getSwitchNamesFromTrigger(_elem,includeSwitches));}else{o.OFF=o.OFF.concat(this.behavior.getSwitchNamesFromTrigger(_elem,includeSwitches));}}}}else{if(elem.checked){o.ON=o.ON.concat(this.behavior.getSwitchNamesFromTrigger(elem,includeSwitches));}else{o.OFF=o.OFF.concat(this.behavior.getSwitchNamesFromTrigger(elem,includeSwitches));}}
break;default:if(elem.hasClass(this.behavior.CSS_ONSTATE_FLAG)){o.ON=o.ON.concat(this.behavior.getSwitchNamesFromTrigger(elem,includeSwitches));}else{o.OFF=o.OFF.concat(this.behavior.getSwitchNamesFromTrigger(elem,includeSwitches));}
break;}}
var _ON=new Array();for(var i=0;i<o.ON.length;i++){if(!wFORMS.helpers.contains(_ON,o.ON[i])){_ON.push(o.ON[i]);}}
var _OFF=new Array();for(var i=0;i<o.OFF.length;i++){if(!wFORMS.helpers.contains(_OFF,o.OFF[i])){_OFF.push(o.OFF[i]);}}
o.ON=_ON;o.OFF=_OFF;return o;}
wFORMS.behaviors['switch'].getSwitchNamesFromTrigger=function(elem,includeSwitches){return wFORMS.behaviors['switch'].getSwitchNames(elem.className,"trigger",includeSwitches);}
wFORMS.behaviors['switch'].getSwitchNamesFromTarget=function(elem,includeSwitches){return wFORMS.behaviors['switch'].getSwitchNames(elem.className,"target",includeSwitches);}
wFORMS.behaviors['switch'].getSwitchNames=function(className,switchPart,includeSwitches){if(!className||className=='')return[];var names=className.split(" ");var _names=new Array();if(switchPart=='trigger')
var doTriggers=true;else
var doTriggers=false;for(var i=names.length-1;i>=0;i--){var cn=names[i];if(doTriggers){if(cn.indexOf(this.CSS_PREFIX)==0)
var sn=cn.substring(this.CSS_PREFIX.length);}else{if(cn.indexOf(this.CSS_ONSTATE_PREFIX)==0)
var sn=cn.substring(this.CSS_ONSTATE_PREFIX.length);else if(cn.indexOf(this.CSS_OFFSTATE_PREFIX)==0)
var sn=cn.substring(this.CSS_OFFSTATE_PREFIX.length);}
if(sn&&(!includeSwitches||wFORMS.helpers.contains(includeSwitches,sn))){_names.push(sn);}}
return _names;}
wFORMS.behaviors['switch'].instance.prototype.getTargetsBySwitchName=function(sName,state){var res=new Array();var clazz=this;var b=wFORMS.behaviors.repeat;if(arguments[1]=='ON')
var className=[wFORMS.behaviors['switch'].CSS_ONSTATE_PREFIX+sName];else{var className=[wFORMS.behaviors['switch'].CSS_OFFSTATE_PREFIX+sName];}
this.target.querySelectorAll("."+className).forEach(function(elem){if(b&&b.isInDuplicateGroup(elem)&&!(b.isDuplicate(clazz.target)||b.isInDuplicateGroup(clazz.target))){return;}
res.push(base2.DOM.bind(elem));});return res;}
wFORMS.behaviors['switch'].instance.prototype.getTriggersByTarget=function(target){var res=new Array();var clazz=this;var names=wFORMS.behaviors['switch'].getSwitchNamesFromTarget(target);var b=wFORMS.behaviors.repeat;base2.forEach(names,function(name){clazz.target.querySelectorAll("."+wFORMS.behaviors['switch'].CSS_PREFIX+name).forEach(function(elem){if(b&&b.isInDuplicateGroup(elem)&&!(b.isDuplicate(target)||b.isInDuplicateGroup(target))){return;}
res.push(base2.DOM.bind(elem));});});return this.getTriggersByElements(res,names);}
wFORMS.behaviors['switch'].instance.prototype.setupTargets=function(elem){this.run(null,elem)}
wFORMS.behaviors['switch'].isSwitchedOff=function(elem){return(elem.className.match(new RegExp(wFORMS.behaviors['switch'].CSS_OFFSTATE_PREFIX+"[^ ]*"))?true:false)&&(elem.className.match(new RegExp(wFORMS.behaviors['switch'].CSS_ONSTATE_PREFIX+"[^ ]*"))?false:true);}
wFORMS.behaviors['switch'].instance.prototype.run=function(e,element){if(!element.hasClass)base2.DOM.bind(element);if(element.hasClass(this.behavior.CSS_ONSTATE_FLAG)){element.removeClass(this.behavior.CSS_ONSTATE_FLAG);element.addClass(this.behavior.CSS_OFFSTATE_FLAG);if(e)e.preventDefault();}else if(element.hasClass(this.behavior.CSS_OFFSTATE_FLAG)){element.removeClass(this.behavior.CSS_OFFSTATE_FLAG);element.addClass(this.behavior.CSS_ONSTATE_FLAG);if(e)e.preventDefault();}
var triggers=this.getTriggersByElements(new Array(element));var clazz=this;base2.forEach(triggers.OFF,function(switchName){var targets=clazz.getTargetsBySwitchName(switchName,'ON');base2.forEach(targets,function(elem){elem.addClass(wFORMS.behaviors['switch'].CSS_OFFSTATE_PREFIX+switchName);elem.removeClass(wFORMS.behaviors['switch'].CSS_ONSTATE_PREFIX+switchName);var _triggers=clazz.getTriggersByTarget(elem);if(_triggers.ON.length==0){clazz.behavior.onSwitchOff(elem);}})});base2.forEach(triggers.ON,function(switchName){var targets=clazz.getTargetsBySwitchName(switchName,'OFF');base2.forEach(targets,function(elem){elem.removeClass(wFORMS.behaviors['switch'].CSS_OFFSTATE_PREFIX+switchName);elem.addClass(wFORMS.behaviors['switch'].CSS_ONSTATE_PREFIX+switchName);clazz.behavior.onSwitchOn(elem);})});if(b=wFORMS.getBehaviorInstance(this.target,'paging')){b.setupManagedControls();}
this.behavior.onSwitch(this.target);}
if(typeof(wFORMS)=="undefined"){throw new Error("wFORMS core not found. This behavior depends on the wFORMS core.");}
wFORMS.behaviors.validation={ERROR_PLACEHOLDER_SUFFIX:'-E',rules:{isRequired:{selector:".required",check:'validateRequired'},isAlpha:{selector:".validate-alpha",check:'validateAlpha'},isAlphanum:{selector:".validate-alphanum",check:'validateAlphanum'},isDate:{selector:".validate-date",check:'validateDate'},isTime:{selector:".validate-time",check:'validateTime'},isEmail:{selector:".validate-email",check:'validateEmail'},isInteger:{selector:".validate-integer",check:'validateInteger'},isFloat:{selector:".validate-float",check:'validateFloat'},isCustom:{selector:".validate-custom",check:'validateCustom'}},styling:{fieldError:"errFld",errorMessage:"errMsg"},messages:{isRequired:"This field is required. ",isAlpha:"The text must use alphabetic characters only (a-z, A-Z). Numbers are not allowed.",isEmail:"This does not appear to be a valid email address.",isInteger:"Please enter an integer.",isFloat:"Please enter a number (ex. 1.9).",isAlphanum:"Please use alpha-numeric characters only [a-z 0-9].",isDate:"This does not appear to be a valid date.",isCustom:"Please enter a valid value.",notification:"%% error(s) detected. Your form has not been submitted yet.\nPlease check the information you provided."},instance:function(f){this.behavior=wFORMS.behaviors.validation;this.target=f;},onPass:function(f){},onFail:function(f){}}
wFORMS.behaviors.validation.applyTo=function(f){if(!f||!f.tagName){throw new Error("Can't apply behavior to "+f);}
if(f.tagName!="FORM"){if(f.form)
f=f.form;else{var _f=f;for(f=f.parentNode;f&&f.tagName!="FORM";f=f.parentNode)continue;if(!f||f.tagName!="FORM"){f=_f.getElementsByTagName('form');}}}
if(!f.tagName&&f.length>0){var v=new Array();for(var i=0;i<f.length;i++){var _v=new wFORMS.behaviors.validation.instance(f[i]);if(!f[i].addEventListener)base2.DOM.bind(f[i]);f[i].addEventListener('submit',function(e){return _v.run(e,this)},false);v.push(_v);_v.onApply();}}else{var v=new wFORMS.behaviors.validation.instance(f);if(!f.addEventListener)base2.DOM.bind(f);f.addEventListener('submit',function(e){return v.run(e,this)},false);v.onApply();}
return v;}
wFORMS.behaviors.validation.instance.prototype.onApply=function(){}
wFORMS.behaviors.validation.instance.prototype.run=function(e,element){var errorCount=0;this.elementsInError={};for(var ruleName in this.behavior.rules){var rule=this.behavior.rules[ruleName];var _self=this;if(!element.querySelectorAll)
base2.DOM.bind(element);element.querySelectorAll(rule.selector).forEach(function(element){if(wFORMS.behaviors.paging&&!wFORMS.behaviors.paging.isElementVisible(element)){return;}
if(_self.isSwitchedOff(element))
return;var value=wFORMS.helpers.getFieldValue(element);if(rule.check.call){var passed=rule.check.call(_self,element,value);}else{var passed=_self[rule.check].call(_self,element,value);}
if(!passed){if(!element.id)element.id=wFORMS.helpers.randomId();_self.elementsInError[element.id]={id:element.id,rule:ruleName};_self.removeErrorMessage(element);if(rule.fail){rule.fail.call(_self,element,ruleName);}else{_self.fail.call(_self,element,ruleName);}
errorCount++;}else{if(!_self.elementsInError[element.id])
_self.removeErrorMessage(element);if(rule.pass){rule.pass.call(_self,element);}else{_self.pass.call(_self,element);}}});}
if(errorCount>0){if(e){e.preventDefault?e.preventDefault():e.returnValue=false;}
if(this.behavior.onFail)this.behavior.onFail(this);return false;}
if(this.behavior.onPass)this.behavior.onPass(this);return true;}
wFORMS.behaviors.validation.instance.prototype.fail=function(element,ruleName){element.addClass(this.behavior.styling.fieldError);this.addErrorMessage(element,this.behavior.messages[ruleName]);},wFORMS.behaviors.validation.instance.prototype.pass=function(element){}
wFORMS.behaviors.validation.instance.prototype.addErrorMessage=function(element,message){if(!element.id)element.id=wFORMS.helpers.randomId();var txtNode=document.createTextNode(message);var p=document.getElementById(element.id+this.behavior.ERROR_PLACEHOLDER_SUFFIX);if(!p){p=document.createElement("div");p.setAttribute('id',element.id+this.behavior.ERROR_PLACEHOLDER_SUFFIX);if(element.tagName=="TR"){p=(element.getElementsByTagName('TD')[0]).appendChild(p);}else{p=element.parentNode.insertBefore(p,element.nextSibling);}}
p.appendChild(txtNode);base2.DOM.bind(p);p.addClass(this.behavior.styling.errorMessage);}
wFORMS.behaviors.validation.instance.prototype.removeErrorMessage=function(element){if(!element.hasClass)base2.DOM.bind(element);if(element.hasClass(this.behavior.styling.fieldError)){element.removeClass(this.behavior.styling.fieldError);var errorMessage=document.getElementById(element.id+this.behavior.ERROR_PLACEHOLDER_SUFFIX);if(errorMessage){errorMessage.parentNode.removeChild(errorMessage);}}}
wFORMS.behaviors.validation.instance.prototype.isSwitchedOff=function(element){var sb=wFORMS.getBehaviorInstance(this.target,'switch');if(sb){var parentElement=element;while(parentElement&&parentElement.tagName!='BODY'){if(parentElement.className&&parentElement.className.indexOf(sb.behavior.CSS_OFFSTATE_PREFIX)!=-1&&parentElement.className.indexOf(sb.behavior.CSS_ONSTATE_PREFIX)==-1){return true;}
parentElement=parentElement.parentNode;}}
return false;}
wFORMS.behaviors.validation.isErrorPlaceholderId=function(id){return id.match(new RegExp(wFORMS.behaviors.validation.ERROR_PLACEHOLDER_SUFFIX+'$'))!=null;}
wFORMS.behaviors.validation.instance.prototype.isEmpty=function(s){var regexpWhitespace=/^\s+$/;return((s==null)||(s.length==0)||regexpWhitespace.test(s));}
wFORMS.behaviors.validation.instance.prototype.validateRequired=function(element,value){switch(element.tagName){case"INPUT":var inputType=element.getAttribute("type");if(!inputType)inputType='text';switch(inputType.toLowerCase()){case"checkbox":case"radio":return element.checked;break;default:return!this.isEmpty(value);}
break;case"SELECT":return!this.isEmpty(value);break;case"TEXTAREA":return!this.isEmpty(value);break;default:return this.validateOneRequired(element);break;}
return false};wFORMS.behaviors.validation.instance.prototype.validateOneRequired=function(element){if(element.nodeType!=1)return false;if(this.isSwitchedOff(element))
return false;switch(element.tagName){case"INPUT":var inputType=element.getAttribute("type");if(!inputType)inputType='text';switch(inputType.toLowerCase()){case"checkbox":case"radio":return element.checked;break;default:return!this.isEmpty(wFORMS.helpers.getFieldValue(element));}
break;case"SELECT":return!this.isEmpty(wFORMS.helpers.getFieldValue(element));break;case"TEXTAREA":return!this.isEmpty(wFORMS.helpers.getFieldValue(element));break;default:for(var i=0;i<element.childNodes.length;i++){if(this.validateOneRequired(element.childNodes[i]))return true;}
break;}
return false}
wFORMS.behaviors.validation.instance.prototype.validateAlpha=function(element,value){var regexp=/^[a-zA-Z\s]+$/;return this.isEmpty(value)||regexp.test(value);}
wFORMS.behaviors.validation.instance.prototype.validateAlphanum=function(element,value){var regexp=/^[\w\s]+$/;return this.isEmpty(value)||regexp.test(value);}
wFORMS.behaviors.validation.instance.prototype.validateDate=function(element,value){var testDate=new Date(value);return this.isEmpty(value)||!isNaN(testDate);}
wFORMS.behaviors.validation.instance.prototype.validateTime=function(element,value){return true;}
wFORMS.behaviors.validation.instance.prototype.validateEmail=function(element,value){var regexpEmail=/\w{1,}[@][\w\-]{1,}([.]([\w\-]{1,})){1,}$/;return this.isEmpty(value)||regexpEmail.test(value);}
wFORMS.behaviors.validation.instance.prototype.validateInteger=function(element,value){var regexp=/^[+]?\d+$/;return this.isEmpty(value)||regexp.test(value);}
wFORMS.behaviors.validation.instance.prototype.validateFloat=function(element,value){return this.isEmpty(value)||!isNaN(parseFloat(value));}
wFORMS.behaviors.validation.instance.prototype.validateCustom=function(element,value){var pattern=new RegExp("\/(.*)\/([gi]*)");var matches=element.className.match(pattern);if(matches&&matches[0]){var validationPattern=new RegExp(matches[1],matches[2]);if(!value.match(validationPattern)){return false}}
return true;}
if(typeof(wFORMS)=="undefined"){throw new Error("wFORMS core not found. This behavior depends on the wFORMS core.");}
wFORMS.behaviors.calculation={VARIABLE_SELECTOR_PREFIX:"calc-",CHOICE_VALUE_SELECTOR_PREFIX:"calcval-",CALCULATION_SELECTOR:'*[class*="formula="]',CALCULATION_ERROR_MESSAGE:"There was an error computing this field.",instance:function(f){this.behavior=wFORMS.behaviors.calculation;this.target=f;this.calculations=[];}}
wFORMS.behaviors.calculation.applyTo=function(f){var b=new wFORMS.behaviors.calculation.instance(f);f.querySelectorAll(wFORMS.behaviors.calculation.CALCULATION_SELECTOR).forEach(function(elem){var formula=elem.className.substr(elem.className.indexOf('formula=')+8).split(' ')[0];var variables=formula.split(/[^a-zA-Z]+/g);b.varFields=[];for(var i=0;i<variables.length;i++){if(variables[i]!=''){f.querySelectorAll("*[class*=\""+wFORMS.behaviors.calculation.VARIABLE_SELECTOR_PREFIX+variables[i]+"\"]").forEach(function(variable){var exactMatch=((' '+variable.className+' ').indexOf(' '+wFORMS.behaviors.calculation.VARIABLE_SELECTOR_PREFIX+variables[i]+' ')!=-1);if(!exactMatch)return;switch(variable.tagName+":"+variable.getAttribute('type')){case'INPUT:':case'INPUT:null':case'INPUT:text':case'INPUT:hidden':case'INPUT:password':case'TEXTAREA:null':if(!variable._wforms_calc_handled){variable.addEventListener('blur',function(e){return b.run(e,this)},false);variable._wforms_calc_handled=true;}
break;case'INPUT:radio':case'INPUT:checkbox':if(!variable._wforms_calc_handled){variable.addEventListener('click',function(e){return b.run(e,this)},false);variable._wforms_calc_handled=true;}
break;case'SELECT:null':if(!variable._wforms_calc_handled){variable.addEventListener('change',function(e){return b.run(e,this)},false);variable._wforms_calc_handled=true;}
break;default:return;break;}
b.varFields.push({name:variables[i],field:variable});});}}
var calc={field:elem,formula:formula,variables:b.varFields};b.calculations.push(calc);b.compute(calc);});b.onApply();return b;}
wFORMS.behaviors.calculation.instance.prototype.onApply=function(){}
wFORMS.behaviors.calculation.instance.prototype.run=function(event,element){for(var i=0;i<this.calculations.length;i++){var calc=this.calculations[i];for(var j=0;j<calc.variables.length;j++){if(element==calc.variables[j].field){this.compute(calc);}}}}
wFORMS.behaviors.calculation.instance.prototype.refresh=function(event,element){for(var i=0;i<this.calculations.length;i++){var calc=this.calculations[i];if(element==calc.field){this.compute(calc);}}}
wFORMS.behaviors.calculation.instance.prototype.compute=function(calculation){var f=this.target;var formula=calculation.formula;var _processedVariables=new Array();for(var i=0;i<calculation.variables.length;i++){var v=calculation.variables[i];var varval=0;var _self=this;if(wFORMS.helpers.contains(_processedVariables,v.name)){continue;}else{_processedVariables.push(v.name);}
f.querySelectorAll("*[class*=\""+_self.behavior.VARIABLE_SELECTOR_PREFIX+v.name+"\"]").forEach(function(f){var exactMatch=((' '+f.className+' ').indexOf(' '+wFORMS.behaviors.calculation.VARIABLE_SELECTOR_PREFIX+v.name+' ')!=-1);if(!exactMatch)return;if(_self.hasValueInClassName(f)){var value=_self.getValueFromClassName(f);}else{var value=wFORMS.helpers.getFieldValue(f);}
if(!value)value=0;if(value.constructor==Array){for(var j=0;j<value.length;j++){if(String(value[j]).search(/^[\d\.,]*$/)!=-1)
varval+=parseFloat(value[j]);else
(!varval)?(varval=value[j]):(varval=String(varval).concat(value[j]));}}else{if(String(value).search(/^[\d\.,]*$/)!=-1)
varval+=parseFloat(value);else
(!varval)?(varval=value):(varval=String(varval).concat(value));}});var rgx=new RegExp("([^a-z])("+v.name+")([^a-z])","gi");while((' '+formula+' ').match(rgx)){if(String(varval).search(/^[\d\.,]*$/)!=-1)
formula=(' '+formula+' ').replace(rgx,"$1"+varval+"$3");else
formula=(' '+formula+' ').replace(rgx,"$1'"+varval+"'$3");}}
try{var result=eval(formula);if(result=='Infinity'||result=='NaN'||String(result).match('NaN')){result='error';}}catch(x){result='error';}
var validationBehavior=wFORMS.getBehaviorInstance(this.target,'validation');if(validationBehavior){if(!wFORMS.behaviors.validation.messages['calculation']){wFORMS.behaviors.validation.messages['calculation']=this.behavior.CALCULATION_ERROR_MESSAGE;}
validationBehavior.removeErrorMessage(calculation.field);if(result=='error'){validationBehavior.fail(calculation.field,'calculation');}}
calculation.field.value=result;if(calculation.field.className&&(calculation.field.className.indexOf(this.behavior.VARIABLE_SELECTOR_PREFIX)!=-1)){this.run(null,calculation.field);}}
wFORMS.behaviors.calculation.instance.prototype.hasValueInClassName=function(element){switch(element.tagName){case"SELECT":for(var i=0;i<element.options.length;i++){if(element.options[i].className&&element.options[i].className.indexOf(this.behavior.CHOICE_VALUE_SELECTOR_PREFIX)!=-1){return true;}}
return false;break;default:if(!element.className||(' '+element.className).indexOf(' '+this.behavior.CHOICE_VALUE_SELECTOR_PREFIX)==-1)
return false;break;}
return true;}
wFORMS.behaviors.calculation.instance.prototype.getValueFromClassName=function(element){switch(element.tagName){case"INPUT":if(!element.className||element.className.indexOf(this.behavior.CHOICE_VALUE_SELECTOR_PREFIX)==-1)
return null;var value=element.className.split(this.behavior.CHOICE_VALUE_SELECTOR_PREFIX)[1].split(' ')[0];if(element.type=='checkbox')
return element.checked?value:null;if(element.type=='radio')
return element.checked?value:null;return value;break;case"SELECT":if(element.selectedIndex==-1){return null;}
if(element.getAttribute('multiple')){var v=[];for(var i=0;i<element.options.length;i++){if(element.options[i].selected){if(element.options[i].className&&element.options[i].className.indexOf(this.behavior.CHOICE_VALUE_SELECTOR_PREFIX)!=-1){var value=element.options[i].className.split(this.behavior.CHOICE_VALUE_SELECTOR_PREFIX)[1].split(' ')[0];v.push(value);}}}
if(v.length==0)return null;return v;}
if(element.options[element.selectedIndex].className&&element.options[element.selectedIndex].className.indexOf(this.behavior.CHOICE_VALUE_SELECTOR_PREFIX)!=-1){var value=element.options[element.selectedIndex].className.split(this.behavior.CHOICE_VALUE_SELECTOR_PREFIX)[1].split(' ')[0];return value;}
break;case"TEXTAREA":if(!element.className||element.className.indexOf(this.behavior.CHOICE_VALUE_SELECTOR_PREFIX)==-1)
return null;var value=element.className.split(this.behavior.CHOICE_VALUE_SELECTOR_PREFIX)[1].split(' ')[0];return value;break;default:return null;break;}
return null;}